---
title:  Vuex
date: 2022-06-09 16:21:37
permalink: /pages/ea2c16/
categories:
  - 《Vue》
tags:
  - 
---
## 5.1 Vuex概述
### 5.1.1 Vuex概念
1. 概念：专门在Vue中实现*集中式***状态（数据）**管理的一个Vue*插件*，对Vue应用中多个组件的共享状态进行集中式的管理（读/写），也是一种组件间通信的方式，且适用于任意组件间通信
![Vuex共享数据数据流](https://pic.imgdb.cn/item/62a9457d09475431298724c7.png)
### 5.1.2 Vuex使用场景
1. 多个组件依赖于同一状态
2. 来自不同组件的行为需要变更同一状态
### 5.1.3 Vuex工作原理
![Vuex工作原理](https://pic.imgdb.cn/item/62a9455a094754312986fad6.png)

## 5.2 搭建Vuex环境
1. 下载安装Vuex `npm i vuex`
2. 创建`src/store/index.js`该文件用于创建Vuex中最为核心的store
```javascript
import Vue from 'vue'
import Vuex from 'vuex'	// 引入Vuex

Vue.use(Vuex)	// 应用Vuex插件

const actions = {}		// 准备actions——用于响应组件中的动作
const mutations = {}	// 准备mutations——用于操作数据（state）
const state = {}			// 准备state——用于存储数据

// 创建并暴露store
export default new Vuex.Store({
	actions,
	mutations,
	state,
})
```
3. 在`src/main.js`中创建vm时传入store配置项
```javascript
import Vue from 'vue'
import App from './App.vue'
import store from './store'	// 引入store

Vue.config.productionTip = false

new Vue({
	el: '#app',
	render: h => h(App),
	store,										// 配置项添加store
	beforeCreate() {
		Vue.prototype.$bus = this
	}
})
```

## 5.3 Vuex基本使用
1. 初始化数据state，配置actions、mutations，操作文件store.js
2. 组件中读取vuex中的数据`$store.state.数据`
3. 组件中修改vuex中的数据`$store.dispatch('action中的方法名',数据)` 或`$store.commit('mutations中的方法名',数据)`
4. 若没有网络请求或其他业务逻辑，组件中也可越过actions，即不写dispatch，直接编写commit
5. actions一般写小写，mutations一般大写
```javascript
//src/components/Count.vue
// 数据使用
$store.state.sum
// 修改数据
methods: {
    increment(){
        this.$store.commit('JIA',this.n)
    },
    decrement(){
        this.$store.commit('JIAN',this.n)
    },
    incrementOdd(){
        this.$store.dispatch('jiaOdd',this.n)
    },
    incrementWait(){
        this.$store.dispatch('jiaWait',this.n)
    },
}
//`src/store/index.js`内容
const actions = {
	jiaOdd(context,value){	// context 相当于精简版的 $store，是一种上下文对象
		console.log('actions中的jiaOdd被调用了')
		if(context.state.sum % 2){
			context.commit('JIA',value)
		}
	},
	jiaWait(context,value){
		console.log('actions中的jiaWait被调用了')
		setTimeout(()=>{
			context.commit('JIA',value)
		},500)
	}
}
// 一般都大写
const mutations = {
	JIA(state,value){
		console.log('mutations中的JIA被调用了')
		state.sum += value
	},
	JIAN(state,value){
		console.log('mutations中的JIAN被调用了')
		state.sum -= value
	}
}
const state = {
	sum:0 //当前的和
}

// 创建并暴露store
export default new Vuex.Store({
	actions,
	mutations,
	state,
})
```

## 5.4 getters 配置项
1. 概念：当`state`中的数据需要经过加工后再使用时，可以使用`getters`加工，相当于*全局计算属性*
2. 在`store.js`中追加`getters`配置
3. 组件中读取数据`$store.getters.bigSum`
```javascript
......
const getters = {
	bigSum(state){
		return state.sum * 10
	}
}

// 创建并暴露store
export default new Vuex.Store({
	......
	getters
})
```

## 5.5 四个map方法
### 5.5.1 mapState
1. 用于帮助映射state中的数据为计算属性
```javascript
computed: {
  	// 借助mapState生成计算属性：sum、school、subject（对象写法一）
  	...mapState({sum:'sum',school:'school',subject:'subject'}),

  	// 借助mapState生成计算属性：sum、school、subject（数组写法二）
  	...mapState(['sum','school','subject']),
},
```
### 5.5.2 mapGetters
1. 用于帮助映射getters中的数据为计算属性
```javascript
computed: {
    //借助mapGetters生成计算属性：bigSum（对象写法一）
    ...mapGetters({bigSum:'bigSum'}),

    //借助mapGetters生成计算属性：bigSum（数组写法二）
    ...mapGetters(['bigSum'])
},
```
### 5.5.3 mapActions
1. 用于帮助生成与actions对话的方法，即包含`$store.dispatch(xxx)`的函数  
```javascript
methods:{
    //靠mapActions生成：incrementOdd、incrementWait（对象形式）
    ...mapActions({incrementOdd:'jiaOdd',incrementWait:'jiaWait'})

    //靠mapActions生成：incrementOdd、incrementWait（数组形式）
    ...mapActions(['jiaOdd','jiaWait'])
}
```
### 5.5.4 mapMutations
1. 用于帮助生成与mutations对话的方法，即包含`$store.commit(xxx)`的函数 
```javascript
methods:{
    //靠mapActions生成：increment、decrement（对象形式）
    ...mapMutations({increment:'JIA',decrement:'JIAN'}),
    
    //靠mapMutations生成：JIA、JIAN（对象形式）
    ...mapMutations(['JIA','JIAN']),
}
```
2. 注意：mapActions与mapMutations使用时，若需要传递参数需要：在模板中绑定事件时传递好参数，否则参数是事件对象

## 5.6 Vuex模块化
1. 目的：让代码更好维护，让多种数据分类更加明确
2. 修改`store.js`：为了解决不同模块命名冲突的问题，将不同模块的namespaced: true，之后在不同页面中引入`getter``actions``mutations`时，需要加上所属的模块名
```javascript
const countAbout = {
  namespaced: true,	// 开启命名空间
  state: {x:1},
  mutations: { ... },
  actions: { ... },
  getters: {
    bigSum(state){ return state.sum * 10 }
  }
}

const personAbout = {
  namespaced: true,	// 开启命名空间
  state: { ... },
  mutations: { ... },
  actions: { ... }
}

const store = new Vuex.Store({
  modules: {
    countAbout,
    personAbout
  }
})
```
3. 开启命名空间后，组件中读取state数据
```javascript
// 方式一：自己直接读取
this.$store.state.personAbout.list
// 方式二：借助mapState读取：
...mapState('countAbout',['sum','school','subject']),
```
4. 开启命名空间后，组件中读取getters数据
```javascript
//方式一：自己直接读取
this.$store.getters['personAbout/firstPersonName']
//方式二：借助mapGetters读取：
...mapGetters('countAbout',['bigSum'])
```
5. 开启命名空间后，组件中调用dispatch
```javascript
//方式一：自己直接dispatch
this.$store.dispatch('personAbout/addPersonWang',person)
//方式二：借助mapActions：
...mapActions('countAbout',{incrementOdd:'jiaOdd',incrementWait:'jiaWait'})
```
6. 开启命名空间后，组件中调用commit
```javascript
//方式一：自己直接commit
this.$store.commit('personAbout/ADD_PERSON',person)
//方式二：借助mapMutations：
...mapMutations('countAbout',{increment:'JIA',decrement:'JIAN'}),
```
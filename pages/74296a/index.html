<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据类型 | 年华惊风雨的知识库</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="简简单单的知识库汇总">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.f924096c.css" as="style"><link rel="preload" href="/assets/js/app.43c2cf26.js" as="script"><link rel="preload" href="/assets/js/2.f96eca0e.js" as="script"><link rel="preload" href="/assets/js/45.72e29209.js" as="script"><link rel="prefetch" href="/assets/js/10.bc85cf75.js"><link rel="prefetch" href="/assets/js/100.625971d8.js"><link rel="prefetch" href="/assets/js/101.b3c32f87.js"><link rel="prefetch" href="/assets/js/102.3bf50b02.js"><link rel="prefetch" href="/assets/js/103.406fd81a.js"><link rel="prefetch" href="/assets/js/104.897240b1.js"><link rel="prefetch" href="/assets/js/105.634eea14.js"><link rel="prefetch" href="/assets/js/11.3b363d77.js"><link rel="prefetch" href="/assets/js/12.58809464.js"><link rel="prefetch" href="/assets/js/13.48e0ec3e.js"><link rel="prefetch" href="/assets/js/14.86f1f148.js"><link rel="prefetch" href="/assets/js/15.5aec71d5.js"><link rel="prefetch" href="/assets/js/16.f60f4b2c.js"><link rel="prefetch" href="/assets/js/17.be1e8f52.js"><link rel="prefetch" href="/assets/js/18.f3eb9f1b.js"><link rel="prefetch" href="/assets/js/19.3346c91b.js"><link rel="prefetch" href="/assets/js/20.aa9eaba8.js"><link rel="prefetch" href="/assets/js/21.b1c2fe57.js"><link rel="prefetch" href="/assets/js/22.09de122b.js"><link rel="prefetch" href="/assets/js/23.bcbfc185.js"><link rel="prefetch" href="/assets/js/24.b9a7221a.js"><link rel="prefetch" href="/assets/js/25.24c8d455.js"><link rel="prefetch" href="/assets/js/26.c82f5f99.js"><link rel="prefetch" href="/assets/js/27.13e313aa.js"><link rel="prefetch" href="/assets/js/28.604b2adb.js"><link rel="prefetch" href="/assets/js/29.b9e889f8.js"><link rel="prefetch" href="/assets/js/3.1c2fbab6.js"><link rel="prefetch" href="/assets/js/30.e9b0b227.js"><link rel="prefetch" href="/assets/js/31.d2df7604.js"><link rel="prefetch" href="/assets/js/32.3936ea87.js"><link rel="prefetch" href="/assets/js/33.07b9921b.js"><link rel="prefetch" href="/assets/js/34.7c36b2fa.js"><link rel="prefetch" href="/assets/js/35.b0c28aec.js"><link rel="prefetch" href="/assets/js/36.d89bce87.js"><link rel="prefetch" href="/assets/js/37.4790def5.js"><link rel="prefetch" href="/assets/js/38.3f900adf.js"><link rel="prefetch" href="/assets/js/39.77a65b38.js"><link rel="prefetch" href="/assets/js/4.57193269.js"><link rel="prefetch" href="/assets/js/40.e5eef212.js"><link rel="prefetch" href="/assets/js/41.b5e2aed4.js"><link rel="prefetch" href="/assets/js/42.477e81e4.js"><link rel="prefetch" href="/assets/js/43.fba0ad7d.js"><link rel="prefetch" href="/assets/js/44.ced2a21f.js"><link rel="prefetch" href="/assets/js/46.ca0fcd32.js"><link rel="prefetch" href="/assets/js/47.706e45e7.js"><link rel="prefetch" href="/assets/js/48.9b07d2ec.js"><link rel="prefetch" href="/assets/js/49.1e93a937.js"><link rel="prefetch" href="/assets/js/5.a543affa.js"><link rel="prefetch" href="/assets/js/50.7f680f06.js"><link rel="prefetch" href="/assets/js/51.5e1a67a7.js"><link rel="prefetch" href="/assets/js/52.63aaf607.js"><link rel="prefetch" href="/assets/js/53.188de40c.js"><link rel="prefetch" href="/assets/js/54.a1cb5365.js"><link rel="prefetch" href="/assets/js/55.837f3a71.js"><link rel="prefetch" href="/assets/js/56.39813210.js"><link rel="prefetch" href="/assets/js/57.77de5448.js"><link rel="prefetch" href="/assets/js/58.d1d4e042.js"><link rel="prefetch" href="/assets/js/59.330296bc.js"><link rel="prefetch" href="/assets/js/6.2d31ac0f.js"><link rel="prefetch" href="/assets/js/60.e460d057.js"><link rel="prefetch" href="/assets/js/61.b1bbc352.js"><link rel="prefetch" href="/assets/js/62.73e7fd7c.js"><link rel="prefetch" href="/assets/js/63.830a4ce6.js"><link rel="prefetch" href="/assets/js/64.f6b6d6e8.js"><link rel="prefetch" href="/assets/js/65.360be319.js"><link rel="prefetch" href="/assets/js/66.6ec1601e.js"><link rel="prefetch" href="/assets/js/67.939f1e28.js"><link rel="prefetch" href="/assets/js/68.9bf9b4bf.js"><link rel="prefetch" href="/assets/js/69.2cda4e4e.js"><link rel="prefetch" href="/assets/js/7.b4570dd1.js"><link rel="prefetch" href="/assets/js/70.8c40764a.js"><link rel="prefetch" href="/assets/js/71.10d53f76.js"><link rel="prefetch" href="/assets/js/72.5422aa3d.js"><link rel="prefetch" href="/assets/js/73.d69494b3.js"><link rel="prefetch" href="/assets/js/74.0c6e9990.js"><link rel="prefetch" href="/assets/js/75.904c111a.js"><link rel="prefetch" href="/assets/js/76.d033d761.js"><link rel="prefetch" href="/assets/js/77.83f0b5e4.js"><link rel="prefetch" href="/assets/js/78.3a57f458.js"><link rel="prefetch" href="/assets/js/79.df105e8f.js"><link rel="prefetch" href="/assets/js/8.fb6278ad.js"><link rel="prefetch" href="/assets/js/80.1a138f38.js"><link rel="prefetch" href="/assets/js/81.2e196dae.js"><link rel="prefetch" href="/assets/js/82.fee27c99.js"><link rel="prefetch" href="/assets/js/83.ad889686.js"><link rel="prefetch" href="/assets/js/84.eda4ad28.js"><link rel="prefetch" href="/assets/js/85.5b49c997.js"><link rel="prefetch" href="/assets/js/86.b86409fd.js"><link rel="prefetch" href="/assets/js/87.945e03f3.js"><link rel="prefetch" href="/assets/js/88.c40c83be.js"><link rel="prefetch" href="/assets/js/89.d7c8ee8d.js"><link rel="prefetch" href="/assets/js/9.8c310901.js"><link rel="prefetch" href="/assets/js/90.14561d9b.js"><link rel="prefetch" href="/assets/js/91.bc5ed798.js"><link rel="prefetch" href="/assets/js/92.c02365cb.js"><link rel="prefetch" href="/assets/js/93.cb9d227a.js"><link rel="prefetch" href="/assets/js/94.5417cc79.js"><link rel="prefetch" href="/assets/js/95.d69d15cb.js"><link rel="prefetch" href="/assets/js/96.9e4d7632.js"><link rel="prefetch" href="/assets/js/97.9093b69f.js"><link rel="prefetch" href="/assets/js/98.230cb308.js"><link rel="prefetch" href="/assets/js/99.35842c80.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f924096c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/tosaka.png" alt="年华惊风雨的知识库" class="logo"> <span class="site-name can-hide">年华惊风雨的知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/pages/2eedd5/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/2729d6/" class="nav-link">CSS</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="http://xxpromise.gitee.io/webpack5-docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Webpack
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>开发文档</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/196903/" class="nav-link">ABP故障诊断系统开发文档</a></li><li class="dropdown-subitem"><a href="/pages/a1eaa9/" class="nav-link">Electron-vue桌面端开发总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><a href="/basic/" class="link-title">计算机基础</a> <span class="title" style="display:none;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/c317e3/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/8b9558/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/pages/184fd9/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/74296a/.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/pages/74296a/.html" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/note/Web3D/" class="nav-link">Web3D</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他技术" class="dropdown-title"><a href="/technology/" class="link-title">其他技术</a> <span class="title" style="display:none;">其他技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/42ad71/" class="nav-link">Python</a></li><li class="dropdown-item"><!----> <a href="/pages/74296a/.html" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/74296a/.html" class="nav-link">机器学习</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://wenshuyuan.work:4900/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大屏故障诊断系统
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/pages/cd11f8/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/8384dd/" class="nav-link">收藏</a></li><li class="dropdown-item"><!----> <a href="/pages/74296a/.html" class="nav-link">实战技巧</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/wsy425" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://pic.imgdb.cn/item/625414d8239250f7c5eabd62.jpg"> <div class="blogger-info"><h3>年华惊风雨</h3> <span>一时竟想不出什么可以写</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/pages/2eedd5/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/pages/2729d6/" class="nav-link">CSS</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="http://xxpromise.gitee.io/webpack5-docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Webpack
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>开发文档</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/196903/" class="nav-link">ABP故障诊断系统开发文档</a></li><li class="dropdown-subitem"><a href="/pages/a1eaa9/" class="nav-link">Electron-vue桌面端开发总结</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><a href="/basic/" class="link-title">计算机基础</a> <span class="title" style="display:none;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/c317e3/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/pages/8b9558/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/pages/184fd9/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/pages/74296a/.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/pages/74296a/.html" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/note/Web3D/" class="nav-link">Web3D</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他技术" class="dropdown-title"><a href="/technology/" class="link-title">其他技术</a> <span class="title" style="display:none;">其他技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/42ad71/" class="nav-link">Python</a></li><li class="dropdown-item"><!----> <a href="/pages/74296a/.html" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/74296a/.html" class="nav-link">机器学习</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://wenshuyuan.work:4900/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大屏故障诊断系统
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/pages/cd11f8/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/8384dd/" class="nav-link">收藏</a></li><li class="dropdown-item"><!----> <a href="/pages/74296a/.html" class="nav-link">实战技巧</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/wsy425" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《JavaScript初学》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>《现代JavaScript教程》</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span> JavaScript编程语言</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/9503d3/" class="sidebar-link">简介</a></li><li><a href="/pages/f7ae59/" class="sidebar-link">JavaScript基础知识</a></li><li><a href="/pages/d2d293/" class="sidebar-link">JavaScript基础语法</a></li><li><a href="/pages/ad315d/" class="sidebar-link">Object对象</a></li><li><a href="/pages/74296a/" aria-current="page" class="active sidebar-link">数据类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/74296a/#_5-数据类型" class="sidebar-link">5 数据类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/74296a/#_5-1-原始数据类型方法" class="sidebar-link">5.1 原始数据类型方法</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-1-1-原始类型与对象" class="sidebar-link">5.1.1 原始类型与对象</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-1-2-当作对象的原始类型" class="sidebar-link">5.1.2 当作对象的原始类型</a></li><li class="sidebar-sub-header level3"><a href="/pages/74296a/#_5-2-数字类型" class="sidebar-link">5.2 数字类型</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-2-1-编写数字的更多方法" class="sidebar-link">5.2.1 编写数字的更多方法</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#下划线" class="sidebar-link">下划线 _</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#字母-e" class="sidebar-link">字母 e</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-2-2-十六进制-二进制和八进制数字" class="sidebar-link">5.2.2 十六进制，二进制和八进制数字</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-2-3-tostring-base" class="sidebar-link">5.2.3 toString(base)</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-2-4-舍入" class="sidebar-link">5.2.4 舍入</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#数字舍入到小数点后-n-位" class="sidebar-link">数字舍入到小数点后 n 位</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-2-5-不精确的计算" class="sidebar-link">5.2.5 不精确的计算</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-2-6-isfinite-和-isnan" class="sidebar-link">5.2.6 isFinite 和 isNaN</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#isnan-value" class="sidebar-link">isNaN(value)</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#isfinite-value" class="sidebar-link">isFinite(value)</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-2-7-parseint-和-parsefloat" class="sidebar-link">5.2.7 parseInt 和 parseFloat</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-2-8-math对象" class="sidebar-link">5.2.8 Math对象</a></li><li class="sidebar-sub-header level3"><a href="/pages/74296a/#_5-3-字符串" class="sidebar-link">5.3 字符串</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-3-1-引号-quotes" class="sidebar-link">5.3.1 引号（Quotes）</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-3-2-特殊字符" class="sidebar-link">5.3.2 特殊字符</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-3-3-字符串长度" class="sidebar-link">5.3.3 字符串长度</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-3-4-访问字符" class="sidebar-link">5.3.4 访问字符</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-3-5-字符串是不可变的" class="sidebar-link">5.3.5 字符串是不可变的</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-3-6-改变大小写" class="sidebar-link">5.3.6 改变大小写</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-3-7-查找子字符串" class="sidebar-link">5.3.7 查找子字符串</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#str-indexof" class="sidebar-link">str.indexOf</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#includes-startswith-endswith" class="sidebar-link">includes，startsWith，endsWith</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-3-8-获取子字符串" class="sidebar-link">5.3.8 获取子字符串</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#str-slice-start-end" class="sidebar-link">str.slice(start [, end])</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#str-substring-start-end" class="sidebar-link">str.substring(start [, end])</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#str-substr-start-length" class="sidebar-link">str.substr(start [, length])</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-3-8-比较字符串" class="sidebar-link">5.3.8 比较字符串</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#正确的比较" class="sidebar-link">正确的比较</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-3-9-unicode" class="sidebar-link">5.3.9 Unicode</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#代理对" class="sidebar-link">代理对</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#变音符号与规范化" class="sidebar-link">变音符号与规范化</a></li><li class="sidebar-sub-header level3"><a href="/pages/74296a/#_5-4-数组" class="sidebar-link">5.4 数组</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-4-1-声明数组" class="sidebar-link">5.4.1 声明数组</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-4-2-简单使用数组" class="sidebar-link">5.4.2 简单使用数组</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-4-3-使用-at-获取最后一个元素" class="sidebar-link">5.4.3 使用 &quot;at&quot; 获取最后一个元素</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-4-4-pop-push-shift-unshift-方法" class="sidebar-link">5.4.4 pop/push, shift/unshift 方法</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-4-5-数组原理" class="sidebar-link">5.4.5 数组原理</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-4-6-数组性能" class="sidebar-link">5.4.6 数组性能</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-4-7-数组循环" class="sidebar-link">5.4.7 数组循环</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-4-8-数组-length" class="sidebar-link">5.4.8 数组 &quot;length&quot;</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-4-9-new-array" class="sidebar-link">5.4.9 new Array()</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-4-10-多维数组" class="sidebar-link">5.4.10 多维数组</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-4-11-tostring" class="sidebar-link">5.4.11 toString</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-4-12-不要使用-比较数组" class="sidebar-link">5.4.12 不要使用 == 比较数组</a></li><li class="sidebar-sub-header level3"><a href="/pages/74296a/#_5-5-数组方法" class="sidebar-link">5.5 数组方法</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-5-1-添加-移除数组元素" class="sidebar-link">5.5.1 添加/移除数组元素</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#splice" class="sidebar-link">splice</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#slice" class="sidebar-link">slice</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#concat" class="sidebar-link">concat</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-5-2-遍历-foreach" class="sidebar-link">5.5.2 遍历：forEach</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-5-3-搜索数组" class="sidebar-link">5.5.3 搜索数组</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#indexof-lastindexof-和-includes" class="sidebar-link">indexOf/lastIndexOf 和 includes</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#find-和-findindex-findlastindex" class="sidebar-link">find 和 findIndex/findLastIndex</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#filter" class="sidebar-link">filter</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-5-4-转换数组" class="sidebar-link">5.5.4 转换数组</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#map" class="sidebar-link">map</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#sort-fn" class="sidebar-link">sort(fn)</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#reverse" class="sidebar-link">reverse</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#split-和-join" class="sidebar-link">split 和 join</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#reduce-reduceright" class="sidebar-link">reduce/reduceRight</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-5-5-array-isarray" class="sidebar-link">5.5.5 Array.isArray</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-5-6-大多数方法都支持-thisarg" class="sidebar-link">5.5.6 大多数方法都支持 &quot;thisArg&quot;</a></li><li class="sidebar-sub-header level3"><a href="/pages/74296a/#_5-6-可迭代对象" class="sidebar-link">5.6 可迭代对象</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-6-1-symbol-iterator" class="sidebar-link">5.6.1 Symbol.iterator</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-6-2-字符串迭代" class="sidebar-link">5.6.2 字符串迭代</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-6-3-显示调用迭代器" class="sidebar-link">5.6.3 显示调用迭代器</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-6-4-可迭代-iterable-和类数组-array-like" class="sidebar-link">5.6.4 可迭代（iterable）和类数组（array-like）</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-6-5-array-from" class="sidebar-link">5.6.5 Array.from</a></li><li class="sidebar-sub-header level3"><a href="/pages/74296a/#_5-7-映射和集合" class="sidebar-link">5.7 映射和集合</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-7-1-map" class="sidebar-link">5.7.1 Map</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#map-比较键" class="sidebar-link">Map 比较键</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#链式调用" class="sidebar-link">链式调用</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-7-2-map-迭代" class="sidebar-link">5.7.2 Map 迭代</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-7-3-object-entries-从对象创建-map" class="sidebar-link">5.7.3 Object.entries：从对象创建 Map</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-7-4-object-fromentries-从-map-创建对象" class="sidebar-link">5.7.4 Object.fromEntries：从 Map 创建对象</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-7-5-set" class="sidebar-link">5.7.5 Set</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-7-6-set-迭代-iteration" class="sidebar-link">5.7.6 Set 迭代（iteration）</a></li><li class="sidebar-sub-header level3"><a href="/pages/74296a/#_5-8-weakmap-and-weakset-弱映射和弱集合" class="sidebar-link">5.8 WeakMap and WeakSet（弱映射和弱集合）</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-8-1-weakmap" class="sidebar-link">5.8.1 WeakMap</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-8-2-weakmap使用案例" class="sidebar-link">5.8.2 WeakMap使用案例</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#额外的数据" class="sidebar-link">额外的数据</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#缓存" class="sidebar-link">缓存</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-8-3-weakset" class="sidebar-link">5.8.3 WeakSet</a></li><li class="sidebar-sub-header level3"><a href="/pages/74296a/#_5-9-对象迭代" class="sidebar-link">5.9 对象迭代</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-9-1-object-keys-values-entries" class="sidebar-link">5.9.1  Object.keys，values，entries</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-9-2-转换对象" class="sidebar-link">5.9.2 转换对象</a></li><li class="sidebar-sub-header level3"><a href="/pages/74296a/#_5-10-解构赋值" class="sidebar-link">5.10 解构赋值</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-10-1-数组解构" class="sidebar-link">5.10.1 数组解构</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#其余的" class="sidebar-link">其余的 '...'</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#默认值" class="sidebar-link">默认值</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-10-2-对象解构" class="sidebar-link">5.10.2 对象解构</a></li><li class="sidebar-sub-header level5"><a href="/pages/74296a/#剩余模式-pattern" class="sidebar-link">剩余模式（pattern）&quot;...&quot;</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-10-3-嵌套解构" class="sidebar-link">5.10.3 嵌套解构</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-10-4-智能函数参数" class="sidebar-link">5.10.4 智能函数参数</a></li><li class="sidebar-sub-header level3"><a href="/pages/74296a/#_5-11-日期和时间" class="sidebar-link">5.11 日期和时间</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-11-1-创建" class="sidebar-link">5.11.1 创建</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-11-2-访问日期组件" class="sidebar-link">5.11.2 访问日期组件</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-11-3-设置日期组件" class="sidebar-link">5.11.3 设置日期组件</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-11-4-自动校准-autocorrection" class="sidebar-link">5.11.4 自动校准（Autocorrection）</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-11-5-日期转化为数字-日期差值" class="sidebar-link">5.11.5 日期转化为数字，日期差值</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-11-6-date-now" class="sidebar-link">5.11.6 Date.now()</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-11-7-基准测试-benchmarking" class="sidebar-link">5.11.7 基准测试（Benchmarking）</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-11-8-对字符串调用-date-parse" class="sidebar-link">5.11.8 对字符串调用 Date.parse</a></li><li class="sidebar-sub-header level3"><a href="/pages/74296a/#_5-12-json" class="sidebar-link">5.12 JSON</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-12-1-json-stringify" class="sidebar-link">5.12.1 JSON.stringify</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-12-2-排除和转换-replacer" class="sidebar-link">5.12.2 排除和转换：replacer</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-12-3-格式化-space" class="sidebar-link">5.12.3 格式化：space</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-12-4-自定义-tojson" class="sidebar-link">5.12.4 自定义 &quot;toJSON&quot;</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-12-5-json-parse" class="sidebar-link">5.12.5  JSON.parse</a></li><li class="sidebar-sub-header level4"><a href="/pages/74296a/#_5-12-6-使用-reviver" class="sidebar-link">5.12.6 使用 reviver</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span> 浏览器：文档、事件、接口</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/categories/?category=%E3%80%8AJavaScript%E3%80%8B" title="分类" data-v-0c557b5e>《JavaScript》</a></li><li data-v-0c557b5e><a href="/categories/?category=%E3%80%8A%E7%8E%B0%E4%BB%A3JavaScript%E6%95%99%E7%A8%8B%E3%80%8B" title="分类" data-v-0c557b5e>《现代JavaScript教程》</a></li><li data-v-0c557b5e><a href="/categories/?category=%20JavaScript%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80" title="分类" data-v-0c557b5e> JavaScript编程语言</a></li></ul> <div class="info" data-v-0c557b5e><div title="作者" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="https://github.com/wsy425" target="_blank" title="作者" class="beLink" data-v-0c557b5e>年华惊风雨</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2022-09-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">数据类型<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="_5-数据类型"><a href="#_5-数据类型" class="header-anchor">#</a> 5 数据类型</h2> <h3 id="_5-1-原始数据类型方法"><a href="#_5-1-原始数据类型方法" class="header-anchor">#</a> 5.1 原始数据类型方法</h3> <p>JavaScript 允许我们像使用对象一样使用原始类型（字符串，数字等）。JavaScript 还提供了这样的调用方法</p> <h4 id="_5-1-1-原始类型与对象"><a href="#_5-1-1-原始类型与对象" class="header-anchor">#</a> 5.1.1 原始类型与对象</h4> <p>原始值：</p> <ul><li>是原始类型中的一种值。</li> <li>在 JavaScript 中有 7 种原始类型：<code>string</code>，<code>number</code>，<code>bigint</code>，<code>boolean</code>，<code>symbol</code>，<code>null</code> 和 <code>undefined</code>。</li></ul> <p>对象：</p> <ul><li>能够存储多个值作为属性。</li> <li>可以使用大括号 <code>{}</code> 创建对象，例如：<code>{name: &quot;John&quot;, age: 30}</code>。JavaScript 中还有其他种类的对象，例如函数就是对象</li></ul> <p>对象比原始类型“更重”。它们需要额外的资源来支持运作</p> <h4 id="_5-1-2-当作对象的原始类型"><a href="#_5-1-2-当作对象的原始类型" class="header-anchor">#</a> 5.1.2 当作对象的原始类型</h4> <p>在保持原始类型轻量的前提下提供可以用方法访问的操作，所以提出了<strong>对象包装器</strong>，实现下面的解决方案</p> <ol><li>原始类型仍然是原始的。与预期相同，提供单个值</li> <li>JavaScript 允许访问字符串，数字，布尔值和 symbol 的方法和属性</li> <li>为了使它们起作用，创建了提供额外功能的特殊“对象包装器”，使用后即被销毁</li></ol> <p><mark>“对象包装器”</mark>对于每种原始类型都是不同的，它们被称为 <code>String</code>、<code>Number</code>、<code>Boolean</code>、<code>Symbol</code> 和 <code>BigInt</code>。因此，它们提供了不同的方法</p> <p>用法演示如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// HELLO</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>以下是 <code>str.toUpperCase()</code> 中实际发生的情况：</p> <ol><li>字符串 <code>str</code> 是一个原始值。因此，在访问其属性时，会创建一个包含字符串字面值的特殊对象，并且具有有用的方法，例如 <code>toUpperCase()</code>。</li> <li>该方法运行并返回一个新的字符串（由 <code>alert</code> 显示）。</li> <li>特殊对象被销毁，只留下原始值 <code>str</code>。</li></ol> <p>JavaScript 引擎高度优化了这个过程。它甚至可能跳过创建额外的对象。但是它仍然必须遵守规范，并且表现得好像它创建了一样</p> <div class="custom-block warning"><p class="custom-block-title">构造器 `String/Number/Boolean` 仅供内部使用</p> <p>像 Java 这样的一些语言允许我们使用 <code>new Number(1)</code> 或 <code>new Boolean(false)</code> 等语法，明确地为原始类型创建“对象包装器”。
在 JavaScript 中，由于历史原因，这也是可以的，但极其 <strong>不推荐</strong>。因为这样会出问题。
例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token keyword">typeof</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;number&quot;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token keyword">typeof</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;object&quot;!</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>对象在 <code>if</code> 中始终为真，因此此处的 alert 将显示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> zero <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>zero<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// zero 为 true，因为它是一个对象</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;zero is truthy?!?&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>另一方面，调用不带 <code>new</code>（关键字）的 <code>String/Number/Boolean</code> 函数是完全理智和有用的。它们将一个值转换为相应的类型：转成字符串、数字或布尔值（原始类型）。
例如，下面完全是有效的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将字符串转成数字</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <div class="custom-block warning"><p class="custom-block-title">null/undefined 没有任何方法</p> <p>特殊的原始类型 <code>null</code> 和 <code>undefined</code> 是例外。它们没有对应的“对象包装器”，也没有提供任何方法。从某种意义上说，它们是“最原始的”。
尝试访问这种值的属性会导致错误：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">.</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <h3 id="_5-2-数字类型"><a href="#_5-2-数字类型" class="header-anchor">#</a> 5.2 数字类型</h3> <p>在现代 JavaScript 中，数字（number）有两种类型：</p> <ol><li><p>JavaScript 中的常规数字以 64 位的格式 <a href="https://en.wikipedia.org/wiki/IEEE_754-2008_revision" target="_blank" rel="noopener noreferrer">IEEE-754<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 存储，也被称为“双精度浮点数”。这是我们大多数时候所使用的数字，我们将在本章中学习它们。</p></li> <li><p>BigInt 数字，用于表示任意长度的整数。有时会需要它们，因为常规数字不能安全地超过 <code>2<sup>53</sup></code> 或小于 <code>-2<sup>53</sup></code>。由于仅在少数特殊领域才会用到 BigInt</p></li></ol> <p>所以，此章节我们讨论的都是常规数字类型</p> <h4 id="_5-2-1-编写数字的更多方法"><a href="#_5-2-1-编写数字的更多方法" class="header-anchor">#</a> 5.2.1 编写数字的更多方法</h4> <h5 id="下划线"><a href="#下划线" class="header-anchor">#</a> 下划线 <code>_</code></h5> <p>可以使用下划线 <code>_</code> 作为数字的分隔符，下划线 <code>_</code> 扮演了“<a href="https://en.wikipedia.org/wiki/Syntactic_sugar" target="_blank" rel="noopener noreferrer">语法糖<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>”的角色，使得数字具有更强的可读性。JavaScript 引擎会直接忽略</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> billion1 <span class="token operator">=</span> <span class="token number">1000000000</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> billion2 <span class="token operator">=</span> <span class="token number">1_000_000_000</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="字母-e"><a href="#字母-e" class="header-anchor">#</a> 字母 <code>e</code></h5> <p><code>e</code> 把数字乘以 <code>1</code> 后面跟着给定数量的 0 的数字</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">1e3</span> <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// e3 表示 *1000</span>
<span class="token number">1.23e6</span> <span class="token operator">===</span> <span class="token number">1.23</span> <span class="token operator">*</span> <span class="token number">1000000</span><span class="token punctuation">;</span> <span class="token comment">// e6 表示 *1000000</span>
<span class="token comment">// -3 除以 1 后面跟着 3 个 0 的数字</span>
<span class="token number">1e-3</span> <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// 0.001</span>
<span class="token comment">// -6 除以 1 后面跟着 6 个 0 的数字</span>
<span class="token number">1.23e-6</span> <span class="token operator">===</span> <span class="token number">1.23</span> <span class="token operator">/</span> <span class="token number">1000000</span><span class="token punctuation">;</span> <span class="token comment">// 0.00000123</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_5-2-2-十六进制-二进制和八进制数字"><a href="#_5-2-2-十六进制-二进制和八进制数字" class="header-anchor">#</a> 5.2.2 十六进制，二进制和八进制数字</h4> <p>十六进制有一种较短的写方法：<code>0x</code>，然后是数字</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 十六进制</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token number">0xff</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 255</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token number">0xFF</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 255（一样，大小写没影响）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>二进制和八进制数字系统很少使用，但也支持使用 <code>0b</code> 和 <code>0o</code> 前缀</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">0b11111111</span><span class="token punctuation">;</span> <span class="token comment">// 二进制形式的 255</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">0o377</span><span class="token punctuation">;</span> <span class="token comment">// 八进制形式的 255</span>
<span class="token function">alert</span><span class="token punctuation">(</span> a <span class="token operator">==</span> b <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true，两边是相同的数字，都是 255</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>只有这三种进制支持这种写法。对于其他进制，我们应该使用函数 <code>parseInt</code></p> <h4 id="_5-2-3-tostring-base"><a href="#_5-2-3-tostring-base" class="header-anchor">#</a> 5.2.3 toString(base)</h4> <p>方法 <code>num.toString(base)</code> 返回在给定 <code>base</code> 进制数字系统中 <code>num</code> 的字符串表示形式</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ff</span>
<span class="token function">alert</span><span class="token punctuation">(</span> num<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 11111111</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>base</code> 的范围可以从 <code>2</code> 到 <code>36</code>。默认情况下是 <code>10</code>
常见的用例如下：</p> <ul><li><strong>base=16</strong> 用于十六进制颜色，字符编码等，数字可以是 <code>0..9</code> 或 <code>A..F</code>。</li> <li><strong>base=2</strong> 主要用于调试按位操作，数字可以是 <code>0</code> 或 <code>1</code>。</li> <li><strong>base=36</strong> 是最大进制，数字可以是 <code>0..9</code> 或 <code>A..Z</code>。所有拉丁字母都被用于了表示数字。对于 <code>36</code> 进制来说，一个有趣且有用的例子是，当我们需要将一个较长的数字标识符转换成较短的时候，例如做一个短的 URL。可以简单地使用基数为 <code>36</code> 的数字系统表示：</li></ul> <div class="custom-block warning"><p class="custom-block-title">使用两个点来调用一个方法</p> <p>请注意 <code>123456..toString(36)</code> 中的两个点不是打错了。如果我们想直接在一个数字上调用一个方法，比如上面例子中的 <code>toString</code>，那么我们需要在它后面放置两个点 <code>..</code>。</p> <p>如果我们放置一个点：<code>123456.toString(36)</code>，那么就会出现一个 error，因为 JavaScript 语法隐含了第一个点之后的部分为小数部分。如果我们再放一个点，那么 JavaScript 就知道小数部分为空，现在使用该方法。</p> <p>也可以写成 <code>(123456).toString(36)</code>。</p></div> <h4 id="_5-2-4-舍入"><a href="#_5-2-4-舍入" class="header-anchor">#</a> 5.2.4 舍入</h4> <p>舍入（rounding）是使用数字时最常用的操作之一
<code>Math.floor</code>
: 向下舍入：<code>3.1</code> 变成 <code>3</code>，<code>-1.1</code> 变成 <code>-2</code>。</p> <p><code>Math.ceil</code>
: 向上舍入：<code>3.1</code> 变成 <code>4</code>，<code>-1.1</code> 变成 <code>-1</code>。</p> <p><code>Math.round</code>
: 向最近的整数舍入：<code>3.1</code> 变成 <code>3</code>，<code>3.6</code> 变成 <code>4</code>，中间值 <code>3.5</code> 变成 <code>4</code>。</p> <p><code>Math.trunc</code>（IE 浏览器不支持这个方法）
: 移除小数点后的所有内容而没有舍入：<code>3.1</code> 变成 <code>3</code>，<code>-1.1</code> 变成 <code>-1</code>。</p> <p>这个是总结它们之间差异的表格：</p> <table><thead><tr><th></th> <th><code>Math.floor</code></th> <th><code>Math.ceil</code></th> <th><code>Math.round</code></th> <th><code>Math.trunc</code></th></tr></thead> <tbody><tr><td><code>3.1</code></td> <td><code>3</code></td> <td><code>4</code></td> <td><code>3</code></td> <td><code>3</code></td></tr> <tr><td><code>3.6</code></td> <td><code>3</code></td> <td><code>4</code></td> <td><code>4</code></td> <td><code>3</code></td></tr> <tr><td><code>-1.1</code></td> <td><code>-2</code></td> <td><code>-1</code></td> <td><code>-1</code></td> <td><code>-1</code></td></tr> <tr><td><code>-1.6</code></td> <td><code>-2</code></td> <td><code>-1</code></td> <td><code>-2</code></td> <td><code>-1</code></td></tr></tbody></table> <h5 id="数字舍入到小数点后-n-位"><a href="#数字舍入到小数点后-n-位" class="header-anchor">#</a> 数字舍入到小数点后 <code>n</code> 位</h5> <ol><li><p>乘除法</p> <p>例如，要将数字舍入到小数点后两位，我们可以将数字乘以 <code>100</code>，调用舍入函数，然后再将其除回。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">1.23456</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>num <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.23456 -&gt; 123.456 -&gt; 123 -&gt; 1.23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>函数 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed" target="_blank" rel="noopener noreferrer">toFixed(n)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 将数字舍入到小数点后 <code>n</code> 位，并以字符串形式返回结果。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">12.34</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> num<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;12.3&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这会向上或向下舍入到最接近的值，类似于 <code>Math.round</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">12.36</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> num<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;12.4&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>请注意 <code>toFixed</code> 的结果是一个字符串。如果小数部分比所需要的短，则在结尾添加零：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">12.34</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> num<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;12.34000&quot;，在结尾添加了 0，以达到小数点后五位</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>我们可以使用一元加号或 <code>Number()</code> 调用，将其转换为数字，例如 <code>+ num.toFixed(5)</code>。</p></li></ol> <h4 id="_5-2-5-不精确的计算"><a href="#_5-2-5-不精确的计算" class="header-anchor">#</a> 5.2.5 不精确的计算</h4> <p>在内部，数字是以 64 位格式 <a href="http://en.wikipedia.org/wiki/IEEE_754-1985" target="_blank" rel="noopener noreferrer">IEEE-754<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 表示的，所以正好有 64 位可以存储一个数字：其中 52 位被用于存储这些数字，其中 11 位用于存储小数点的位置（对于整数，它们为零），而 1 位用于符号。</p> <p>如果一个数字真的很大，则可能会溢出 64 位存储，变成一个特殊的数值 <code>Infinity</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token number">1e500</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Infinity</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这可能不那么明显，但经常会发生的是，精度的损失</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">==</span> <span class="token number">0.3</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>一个数字以其二进制的形式存储在内存中，一个 1 和 0 的序列。但是在十进制数字系统中看起来很简单的 <code>0.1</code>，<code>0.2</code> 这样的小数，实际上在二进制形式中是无限循环小数。</p> <p>什么是 <code>0.1</code>？<code>0.1</code> 就是 <code>1</code> 除以 <code>10</code>，<code>1/10</code>，即十分之一。在十进制数字系统中，这样的数字表示起来很容易。将其与三分之一进行比较：<code>1/3</code>。三分之一变成了无限循环小数 <code>0.33333(3)</code>。</p> <p>在十进制数字系统中，可以保证以 <code>10</code> 的整数次幂作为除数能够正常工作，但是以 <code>3</code> 作为除数则不能。也是同样的原因，在二进制数字系统中，可以保证以 <code>2</code> 的整数次幂作为除数时能够正常工作，但 <code>1/10</code> 就变成了一个无限循环的二进制小数。</p> <p>使用二进制数字系统无法 <strong>精确</strong> 存储 <em>0.1</em> 或 <em>0.2</em>，就像没有办法将三分之一存储为十进制小数一样。</p> <p>解决方法中最可靠的是借助<code>toFixed(n)</code>对结果进行舍入</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> sum<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.30</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Hello！我是一个会自我增加的数字！</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token number">9999999999999999</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显示 10000000000000000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>出现了同样的问题：精度损失。有 64 位来表示该数字，其中 52 位可用于存储数字，但这还不够。所以最不重要的数字就消失了。</p> <p>JavaScript 不会在此类事件中触发 error。它会尽最大努力使数字符合所需的格式，但不幸的是，这种格式不够大到满足需求。</p></div> <div class="custom-block tip"><p class="custom-block-title">两个零</p> <p>数字内部表示的另一个有趣结果是存在两个零：<code>0</code> 和 <code>-0</code>。</p> <p>这是因为在存储时，使用一位来存储符号，因此对于包括零在内的任何数字，可以设置这一位或者不设置。</p> <p>在大多数情况下，这种区别并不明显，因为运算符将它们视为相同的值</p></div> <h4 id="_5-2-6-isfinite-和-isnan"><a href="#_5-2-6-isfinite-和-isnan" class="header-anchor">#</a> 5.2.6 isFinite 和 isNaN</h4> <ul><li><code>Infinity</code>（和 <code>-Infinity</code>）是一个特殊的数值，比任何数值都大（小）。</li> <li><code>NaN</code> 代表一个 error。</li></ul> <p>它们属于 <code>number</code> 类型，但不是“普通”数字，因此，这里有用于检查它们的特殊函数</p> <h5 id="isnan-value"><a href="#isnan-value" class="header-anchor">#</a> <code>isNaN(value)</code></h5> <p>将其参数转换为数字，然后测试它是否为 <code>NaN</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">&quot;str&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">NaN独一无二</p> <p>我们不能使用 <code>=== NaN</code> 比较。&quot;NaN&quot; 是独一无二的，它不等于任何东西，包括它自身：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token number">NaN</span> <span class="token operator">===</span> <span class="token number">NaN</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <h5 id="isfinite-value"><a href="#isfinite-value" class="header-anchor">#</a> <code>isFinite(value)</code></h5> <p>将其参数转换为数字，如果是常规数字而不是 <code>NaN/Infinity/-Infinity</code>，则返回 <code>true</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">isFinite</span><span class="token punctuation">(</span><span class="token string">&quot;15&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">isFinite</span><span class="token punctuation">(</span><span class="token string">&quot;str&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false，因为是一个特殊的值：NaN</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">isFinite</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false，因为是一个特殊的值：Infinity</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>有时 <code>isFinite</code> 被用于验证字符串值是否为常规数字：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token operator">+</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">&quot;Enter a number&quot;</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 结果会是 true，除非你输入的是 Infinity、-Infinity 或不是数字</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">isFinite</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>请注意，在所有数字函数中，包括 <code>isFinite</code>，空字符串或仅有空格的字符串均被视为 <code>0</code></p></div> <div class="custom-block tip"><p class="custom-block-title">与 `Object.is` 进行比较</p> <p>有一个特殊的内建方法 <code>Object.is</code>，它类似于 <code>===</code> 一样对值进行比较，但它对于两种边缘情况更可靠：</p> <ol><li>它适用于 <code>NaN</code>：<code>Object.is(NaN，NaN) === true</code>，这是件好事。</li> <li>值 <code>0</code> 和 <code>-0</code> 是不同的：<code>Object.is(0，-0) === false</code>，从技术上讲这是对的，因为在内部，数字的符号位可能会不同，即使其他所有位均为零。</li></ol> <p>在所有其他情况下，<code>Object.is(a，b)</code> 与 <code>a === b</code> 相同。</p> <p>这种比较方式经常被用在 JavaScript 规范中。当内部算法需要比较两个值是否完全相同时，它使用 <code>Object.is</code>（内部称为SameValue）</p></div> <h4 id="_5-2-7-parseint-和-parsefloat"><a href="#_5-2-7-parseint-和-parsefloat" class="header-anchor">#</a> 5.2.7 parseInt 和 parseFloat</h4> <p>使用加号 <code>+</code> 或 <code>Number()</code> 的数字转换是严格的。如果一个值不完全是一个数字，就会失败：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token operator">+</span><span class="token string">&quot;100px&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>唯一的例外是字符串开头或结尾的空格，因为它们会被忽略。</p> <p><code>parseInt</code> 和 <code>parseFloat</code> 可以从字符串中“读取”数字，直到无法读取为止。如果发生 error，则返回收集到的数字。函数 <code>parseInt</code> 返回一个整数，而 <code>parseFloat</code> 返回一个浮点数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'100px'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 100</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">'12.5em'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12.5</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'12.3'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12，只有整数部分被返回了</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">'12.3.4'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12.3，在第二个点出停止了读取</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>某些情况下，<code>parseInt/parseFloat</code> 会返回 <code>NaN</code>。当没有数字可读时会发生这种情况：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'a123'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN，第一个符号停止了读取</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">parseInt(str, radix) 的第二个参数</p> <p><code>parseInt()</code> 函数具有可选的第二个参数。它指定了数字系统的基数，因此 <code>parseInt</code> 还可以解析十六进制数字、二进制数字等的字符串：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'0xff'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 255</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'ff'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 255，没有 0x 仍然有效</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'2n9c'</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <h4 id="_5-2-8-math对象"><a href="#_5-2-8-math对象" class="header-anchor">#</a> 5.2.8 Math对象</h4> <p>JavaScript 有一个内建的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math" target="_blank" rel="noopener noreferrer">Math<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对象，它包含了一个小型的数学函数和常量库
<code>Math.random()</code>
: 返回一个从 0 到 1 的随机数（不包括 1）。</p> <div class="language- extra-class"><pre><code>```js
alert( Math.random() ); // 0.1234567894322
alert( Math.random() ); // 0.5435252343232
alert( Math.random() ); // ... (任何随机数)
```
</code></pre></div><p><code>Math.max(a, b, c...)</code> / <code>Math.min(a, b, c...)</code>
: 从任意数量的参数中返回最大/最小值。</p> <div class="language- extra-class"><pre><code>```js
alert( Math.max(3, 5, -10, 0, 1) ); // 5
alert( Math.min(1, 2) ); // 1
```
</code></pre></div><p><code>Math.pow(n, power)</code>
: 返回 <code>n</code> 的给定（power）次幂。</p> <div class="language- extra-class"><pre><code>```js
alert( Math.pow(2, 10) ); // 2 的 10 次幂 = 1024
```
</code></pre></div><h3 id="_5-3-字符串"><a href="#_5-3-字符串" class="header-anchor">#</a> 5.3 字符串</h3> <p>在 JavaScript 中，文本数据被以字符串形式存储，单个字符没有单独的类型。</p> <p>字符串的内部格式始终是 <a href="https://en.wikipedia.org/wiki/UTF-16" target="_blank" rel="noopener noreferrer">UTF-16<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，它不依赖于页面编码</p> <h4 id="_5-3-1-引号-quotes"><a href="#_5-3-1-引号-quotes" class="header-anchor">#</a> 5.3.1 引号（Quotes）</h4> <p>字符串可以包含在单引号、双引号或反引号中：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> single <span class="token operator">=</span> <span class="token string">'single-quoted'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> double <span class="token operator">=</span> <span class="token string">&quot;double-quoted&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> backticks <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">backticks</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>单引号和双引号基本相同。但是，反引号允许我们通过 <code>${…}</code> 将任何表达式嵌入到字符串中：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">1 + 2 = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 + 2 = 3.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>使用反引号的另一个优点是它们允许字符串跨行：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> guestList <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Guests:
 * John
 * Pete
 * Mary
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>guestList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 客人清单，多行</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_5-3-2-特殊字符"><a href="#_5-3-2-特殊字符" class="header-anchor">#</a> 5.3.2 特殊字符</h4> <p>我们可以通过使用“换行符（newline character）”，以支持使用单引号和双引号来创建跨行字符串。换行符写作 <code>\n</code>，用来表示换行：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> guestList <span class="token operator">=</span> <span class="token string">&quot;Guests:\n * John\n * Pete\n * Mary&quot;</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>guestList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一个多行的客人列表</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>例如，这两行描述的是一样的，只是书写方式不同：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str1 <span class="token operator">=</span> <span class="token string">&quot;Hello\nWorld&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 使用“换行符”创建的两行字符串</span>
<span class="token comment">// 使用反引号和普通的换行创建的两行字符串</span>
<span class="token keyword">let</span> str2 <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello
World</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>str1 <span class="token operator">==</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>还有其他不常见的“特殊”字符。</p> <p>这是完整列表：</p> <table><thead><tr><th>字符</th> <th>描述</th></tr></thead> <tbody><tr><td><code>\n</code></td> <td>换行</td></tr> <tr><td><code>\r</code></td> <td>在 Windows 文本文件中，两个字符 <code>\r\n</code> 的组合代表一个换行。而在非 Windows 操作系统上，它就是 <code>\n</code>。这是历史原因造成的，大多数的 Windows 软件也理解 <code>\n</code>。</td></tr> <tr><td><code>\'</code>, <code>\&quot;</code></td> <td>引号</td></tr> <tr><td><code>\\</code></td> <td>反斜线</td></tr> <tr><td><code>\t</code></td> <td>制表符</td></tr> <tr><td><code>\b</code>, <code>\f</code>, <code>\v</code></td> <td>退格，换页，垂直标签 —— 为了兼容性，现在已经不使用了。</td></tr> <tr><td><code>\xXX</code></td> <td>具有给定十六进制 Unicode <code>XX</code> 的 Unicode 字符，例如：<code>'\x7A'</code> 和 <code>'z'</code> 相同。</td></tr> <tr><td><code>\uXXXX</code></td> <td>以 UTF-16 编码的十六进制代码 <code>XXXX</code> 的 Unicode 字符，例如 <code>\u00A9</code> —— 是版权符号 <code>©</code> 的 Unicode。它必须正好是 4 个十六进制数字。</td></tr> <tr><td><code>\u{X…XXXXXX}</code>（1 到 6 个十六进制字符）</td> <td>具有给定 UTF-32 编码的 Unicode 符号。一些罕见的字符用两个 Unicode 符号编码，占用 4 个字节。这样我们就可以插入长代码了。</td></tr></tbody></table> <p>Unicode 示例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;\u00A9&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ©</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;\u{20331}&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 佫，罕见的中国象形文字（长 Unicode）</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;\u{1F60D}&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 😍，笑脸符号（另一个长 Unicode）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>所有的特殊字符都以反斜杠字符 <code>\</code> 开始。它也被称为“转义字符”。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>注意反斜杠 <code>\</code> 在 JavaScript 中用于正确读取字符串，然后消失。内存中的字符串没有 <code>\</code>。</p></div> <h4 id="_5-3-3-字符串长度"><a href="#_5-3-3-字符串长度" class="header-anchor">#</a> 5.3.3 字符串长度</h4> <p><code>length</code> 属性表示字符串长度：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">My\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span>length <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意 <code>\n</code> 是一个单独的“特殊”字符，所以长度确实是 <code>3</code></p> <div class="custom-block warning"><p class="custom-block-title">`length` 是一个属性</p> <p>掌握其他编程语言的人，有时会错误地调用 <code>str.length()</code> 而不是 <code>str.length</code>。这是行不通的。</p> <p>请注意 <code>str.length</code> 是一个数字属性，而不是函数。后面不需要添加括号</p></div> <h4 id="_5-3-4-访问字符"><a href="#_5-3-4-访问字符" class="header-anchor">#</a> 5.3.4 访问字符</h4> <p>要获取在 <code>pos</code> 位置的一个字符，可以使用方括号 <code>[pos]</code> 或者调用 <a href="mdn:js/String/charAt">str.charAt(pos)</a> 方法。第一个字符从零位置开始</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// 第一个字符</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// H</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// H</span>
<span class="token comment">// 最后一个字符</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">[</span>str<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// o</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>方括号是获取字符的一种现代化方法，而 <code>charAt</code> 是历史原因才存在的。</p> <p>它们之间的唯一区别是，如果没有找到字符，<code>[]</code> 返回 <code>undefined</code>，而 <code>charAt</code> 返回一个空字符串：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ''（空字符串）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>可以使用<code>for.. of</code>遍历字符</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> char <span class="token keyword">of</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//H,e,l,l,o</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_5-3-5-字符串是不可变的"><a href="#_5-3-5-字符串是不可变的" class="header-anchor">#</a> 5.3.5 字符串是不可变的</h4> <p>在 JavaScript 中，字符串不可更改。改变字符是不可能的。</p> <p>我们证明一下为什么不可能：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'Hi'</span><span class="token punctuation">;</span>
str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'h'</span><span class="token punctuation">;</span> <span class="token comment">// error</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 无法运行</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>通常的解决方法是创建一个新的字符串，并将其分配给 <code>str</code> 而不是以前的字符串。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'Hi'</span><span class="token punctuation">;</span>
str <span class="token operator">=</span> <span class="token string">'h'</span> <span class="token operator">+</span> str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 替换字符串</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// hi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_5-3-6-改变大小写"><a href="#_5-3-6-改变大小写" class="header-anchor">#</a> 5.3.6 改变大小写</h4> <p><a href="mdn:js/String/toLowerCase">toLowerCase()</a> 和 <a href="mdn:js/String/toUpperCase">toUpperCase()</a> 方法可以改变大小写：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'Interface'</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// INTERFACE</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'Interface'</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// interface</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>或者我们想要使一个字符变成小写：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'Interface'</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'i'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_5-3-7-查找子字符串"><a href="#_5-3-7-查找子字符串" class="header-anchor">#</a> 5.3.7 查找子字符串</h4> <h5 id="str-indexof"><a href="#str-indexof" class="header-anchor">#</a> str.indexOf</h5> <p><a href="mdn:js/String/indexOf">str.indexOf(substr, pos)</a>从给定位置 <code>pos</code> 开始，在 <code>str</code> 中查找 <code>substr</code>，如果没有找到，则返回 <code>-1</code>，否则返回匹配成功的位置。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'Widget with id'</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'Widget'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0，因为 'Widget' 一开始就被找到</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'widget'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -1，没有找到，检索是大小写敏感的</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1，&quot;id&quot; 在位置 1 处（……idget 和 id）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>可选的第二个参数允许我们从一个给定的位置开始检索。</p> <p>例如，<code>&quot;id&quot;</code> 第一次出现的位置是 <code>1</code>。查询下一个存在位置时，我们从 <code>2</code> 开始检索：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'Widget with id'</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token comment">// 12</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">`str.lastIndexOf(substr, pos)`</p> <p>还有一个类似的方法 <a href="mdn:js/String/lastIndexOf">str.lastIndexOf(substr, position)</a>，它从字符串的末尾开始搜索到开头。</p> <p>它会以相反的顺序列出这些事件</p></div> <p>在 <code>if</code> 测试中 <code>indexOf</code> 有一点不方便。我们不能像这样把它放在 <code>if</code> 中：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;Widget with id&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Widget&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;We found it&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不工作！</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>上述示例中的 <code>alert</code> 不会显示，因为 <code>str.indexOf(&quot;Widget&quot;)</code> 返回 <code>0</code>（意思是它在起始位置就查找到了匹配项）。是的，但是 <code>if</code> 认为 <code>0</code> 表示 <code>false</code>。</p> <p>因此我们应该检查 <code>-1</code>，像这样：</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;Widget with id&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Widget&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;We found it&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 现在工作了！</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">按位（bitwise）NOT 技巧</p> <p>这里使用的一个老技巧是 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_NOT" target="_blank" rel="noopener noreferrer">bitwise NOT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <code>~</code> 运算符。它将数字转换为 32-bit 整数（如果存在小数部分，则删除小数部分），然后对其二进制表示形式中的所有位均取反</p> <p>只有当 <code>n == -1</code> 时，<code>~n</code> 才为零（适用于任何 32-bit 带符号的整数 <code>n</code>）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;Widget&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">~</span>str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Widget&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'Found it!'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 正常运行</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>由于 <code>~</code> 运算符将大数字截断为 32 位，因此存在给出 <code>0</code> 的其他数字，最小的数字是 <code>~4294967295=0</code>。这使得这种检查只有在字符串没有那么长的情况下才是正确的
现在我们只会在旧的代码中看到这个技巧，因为现代 JavaScript 提供了 <code>.includes</code> 方法（见下文）</p></div> <h5 id="includes-startswith-endswith"><a href="#includes-startswith-endswith" class="header-anchor">#</a> includes，startsWith，endsWith</h5> <p>更现代的方法 <a href="mdn:js/String/includes">str.includes(substr, pos)</a> 根据 <code>str</code> 中是否包含 <code>substr</code> 来返回 <code>true/false</code>。</p> <p>如果我们需要检测匹配，但不需要它的位置，那么这是正确的选择：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;Widget with id&quot;</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;Widget&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;Bye&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>str.includes</code> 的第二个可选参数是开始搜索的起始位置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;Widget&quot;</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;Widget&quot;</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false, 从位置 3 开始没有 &quot;id&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>方法 <a href="mdn:js/String/startsWith">str.startsWith</a> 和 <a href="mdn:js/String/endsWith">str.endsWith</a> 的功能与其名称所表示的意思相同：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;Widget&quot;</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;Wid&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true，&quot;Widget&quot; 以 &quot;Wid&quot; 开始</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;Widget&quot;</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true，&quot;Widget&quot; 以 &quot;get&quot; 结束</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_5-3-8-获取子字符串"><a href="#_5-3-8-获取子字符串" class="header-anchor">#</a> 5.3.8 获取子字符串</h4> <p>JavaScript 中有三种获取字符串的方法：<code>substring</code>、<code>substr</code> 和 <code>slice</code></p> <h5 id="str-slice-start-end"><a href="#str-slice-start-end" class="header-anchor">#</a> <code>str.slice(start [, end])</code></h5> <p>返回字符串从 <code>start</code> 到（但不包括）<code>end</code> 的部分</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;stringify&quot;</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'strin'，从 0 到 5 的子字符串（不包括 5）</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 's'，从 0 到 1，但不包括 1，所以只有在 0 处的字符</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果没有第二个参数，<code>slice</code> 会一直运行到字符串末尾：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;stringify&quot;</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从第二个位置直到结束</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>start/end</code> 也有可能是负值。它们的意思是起始位置从字符串结尾计算：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;stringify&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 从右边的第四个位置开始，在右边的第一个位置结束</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'gif'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="str-substring-start-end"><a href="#str-substring-start-end" class="header-anchor">#</a> <code>str.substring(start [, end])</code></h5> <p>返回字符串在 <code>start</code> 和 <code>end</code> <strong>之间</strong> 的部分
这与 <code>slice</code> 几乎相同，但它允许 <code>start</code> 大于 <code>end</code>。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;stringify&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 这些对于 substring 是相同的</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;ring&quot;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;ring&quot;</span>
<span class="token comment">// ……但对 slice 是不同的：</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;ring&quot;（一样）</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&quot;（空字符串）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>不支持负参数（不像 slice），它们被视为 <code>0</code>。</p> <h5 id="str-substr-start-length"><a href="#str-substr-start-length" class="header-anchor">#</a> <code>str.substr(start [, length])</code></h5> <p>返回字符串从 <code>start</code> 开始的给定 <code>length</code> 的部分
与以前的方法相比，这个允许我们指定 <code>length</code> 而不是结束位置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;stringify&quot;</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'ring'，从位置 2 开始，获取 4 个字符</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>第一个参数可能是负数，从结尾算起：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;stringify&quot;</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'gi'，从第 4 位获取 2 个字符</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><table><thead><tr><th>方法</th> <th>选择方式……</th> <th>负值参数</th></tr></thead> <tbody><tr><td><code>slice(start, end)</code></td> <td>从 <code>start</code> 到 <code>end</code>（不含 <code>end</code>）</td> <td>允许</td></tr> <tr><td><code>substring(start, end)</code></td> <td><code>start</code> 与 <code>end</code> 之间（包括 <code>start</code>，但不包括 <code>end</code>）</td> <td>负值代表 <code>0</code></td></tr> <tr><td><code>substr(start, length)</code></td> <td>从 <code>start</code> 开始获取长为 <code>length</code> 的字符串</td> <td>允许 <code>start</code> 为负数</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">使用哪一个？</p> <p>它们都可用于获取子字符串。正式一点来讲，<code>substr</code> 有一个小缺点：它不是在 JavaScript 核心规范中描述的，而是在附录 B 中。附录 B 的内容主要是描述因历史原因而遗留下来的仅浏览器特性。因此，理论上非浏览器环境可能无法支持 <code>substr</code>，但实际上它在别的地方也都能用。</p> <p>相较于其他两个变体，<code>slice</code> 稍微灵活一些，它允许以负值作为参数并且写法更简短。因此仅仅记住这三种方法中的 <code>slice</code> 就足够了</p></div> <h4 id="_5-3-8-比较字符串"><a href="#_5-3-8-比较字符串" class="header-anchor">#</a> 5.3.8 比较字符串</h4> <p>所有的字符串都使用 <a href="https://en.wikipedia.org/wiki/UTF-16" target="_blank" rel="noopener noreferrer">UTF-16<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 编码。即：每个字符都有对应的数字代码。有特殊的方法可以获取代码表示的字符，以及字符对应的代码。</p> <p><code>str.codePointAt(pos)</code>
: 返回在 <code>pos</code> 位置的字符代码 :</p> <div class="language- extra-class"><pre><code>```js
// 不同的字母有不同的代码
alert( &quot;z&quot;.codePointAt(0) ); // 122
alert( &quot;Z&quot;.codePointAt(0) ); // 90
```
</code></pre></div><p><code>String.fromCodePoint(code)</code>
: 通过数字 <code>code</code> 创建字符</p> <div class="language- extra-class"><pre><code>```js
alert( String.fromCodePoint(90) ); // Z
```

我们还可以用 `\u` 后跟十六进制代码，通过这些代码添加 Unicode 字符：

```js
// 在十六进制系统中 90 为 5a
alert( '\u005a' ); // Z
```
</code></pre></div><p>字符通过数字代码进行比较。越大的代码意味着字符越大。<code>a</code>（97）的代码大于 <code>Z</code>（90）的代码。</p> <ul><li>所有小写字母追随在大写字母之后，因为它们的代码更大。</li> <li>一些像 <code>Ö</code> 的字母与主要字母表不同。这里，它的代码比任何从 <code>a</code> 到 <code>z</code> 的代码都要大。</li></ul> <h5 id="正确的比较"><a href="#正确的比较" class="header-anchor">#</a> 正确的比较</h5> <p>现代浏览器（IE10- 需要额外的库 <a href="https://github.com/andyearnshaw/Intl.js/" target="_blank" rel="noopener noreferrer">Intl.JS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) 都支持国际化标准 <a href="http://www.ecma-international.org/ecma-402/1.0/ECMA-402.pdf" target="_blank" rel="noopener noreferrer">ECMA-402<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>它提供了一种特殊的方法来比较不同语言的字符串，遵循它们的规则。</p> <p>调用 <a href="mdn:js/String/localeCompare">str.localeCompare(str2)</a> 会根据语言规则返回一个整数，这个整数能指示字符串 <code>str</code> 在排序顺序中排在字符串 <code>str2</code> 前面、后面、还是相同：</p> <ul><li>如果 <code>str</code> 排在 <code>str2</code> 前面，则返回负数。</li> <li>如果 <code>str</code> 排在 <code>str2</code> 后面，则返回正数。</li> <li>如果它们在相同位置，则返回 <code>0</code>。</li></ul> <h4 id="_5-3-9-unicode"><a href="#_5-3-9-unicode" class="header-anchor">#</a> 5.3.9 Unicode</h4> <h5 id="代理对"><a href="#代理对" class="header-anchor">#</a> 代理对</h5> <p>所有常用的字符都是一个 2 字节的代码。大多数欧洲语言，数字甚至大多数象形文字中的字母都有 2 字节的表示形式。</p> <p>但 2 字节只允许 65536 个组合，这对于表示每个可能的符号是不够的。所以稀有的符号被称为“代理对”的一对 2 字节的符号编码。</p> <p>这些符号的长度是 <code>2</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'𝒳'</span><span class="token punctuation">.</span>length <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2，大写数学符号 X</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'😂'</span><span class="token punctuation">.</span>length <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2，笑哭表情</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'𩷶'</span><span class="token punctuation">.</span>length <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2，罕见的中国象形文字</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>注意，代理对在 JavaScript 被创建时并不存在，因此无法被编程语言正确处理！</p> <p>我们实际上在上面的每个字符串中都有一个符号，但 <code>length</code> 显示长度为 <code>2</code>。</p> <p><code>String.fromCodePoint</code> 和 <code>str.codePointAt</code> 是几种处理代理对的少数方法。它们最近才出现在编程语言中。在它们之前，只有 <a href="mdn:js/String/fromCharCode">String.fromCharCode</a> 和 <a href="mdn:js/String/charCodeAt">str.charCodeAt</a>。这些方法实际上与 <code>fromCodePoint/codePointAt</code> 相同，但是不适用于代理对。</p> <p>获取符号可能会非常麻烦，因为代理对被认为是两个字符：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'𝒳'</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 奇怪的符号……</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'𝒳'</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ……代理对的一块</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>请注意，代理对的各部分没有任何意义。因此，上述示例中的 alert 显示的实际上是垃圾信息。</p> <p>技术角度来说，代理对也是可以通过它们的代码检测到的：如果一个字符的代码在 <code>0xd800..0xdbff</code> 范围内，那么它是代理对的第一部分。下一个字符（第二部分）必须在 <code>0xdc00..0xdfff</code> 范围中。这些范围是按照标准专门为代理对保留的。</p> <p>在上述示例中：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// charCodeAt 不理解代理对，所以它给出了代理对的代码</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'𝒳'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// d835，在 0xd800 和 0xdbff 之间</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'𝒳'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// dcb3, 在 0xdc00 和 0xdfff 之间</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>本章节后面的 iterable 章节中，你可以找到更多处理代理对的方法</p> <h5 id="变音符号与规范化"><a href="#变音符号与规范化" class="header-anchor">#</a> 变音符号与规范化</h5> <p>在许多语言中，都有一些由基本字符组成的符号，在其上方/下方有一个标记。</p> <p>最常见的“复合”字符在 UTF-16 表中都有自己的代码。但不是全部，因为可能的组合太多。</p> <p>为了支持任意组合，UTF-16 允许我们使用多个 Unicode 字符：基本字符紧跟“装饰”它的一个或多个“标记”字符。</p> <p>例如，如果我们 <code>S</code> 后跟有特殊的 &quot;dot above&quot; 字符（代码 <code>\u0307</code>），则显示 Ṡ。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'S\u0307'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Ṡ</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>两个视觉上看起来相同的字符，可以用不同的 Unicode 组合表示。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token string">'S\u0307\u0323'</span><span class="token punctuation">;</span> <span class="token comment">// Ṩ，S + 上点 + 下点</span>
<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token string">'S\u0323\u0307'</span><span class="token punctuation">;</span> <span class="token comment">// Ṩ，S + 下点 + 上点</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">s1: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>s1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, s2: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>s2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> s1 <span class="token operator">==</span> s2 <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false，尽管字符看起来相同（?!）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>为了解决这个问题，有一个 “Unicode 规范化”算法，它将每个字符串都转化成单个“通用”格式。</p> <p>它由 <a href="mdn:js/String/normalize">str.normalize()</a> 实现。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;S\u0307\u0323&quot;</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;S\u0323\u0307&quot;</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>有趣的是，在实际情况下，<code>normalize()</code> 实际上将一个由 3 个字符组成的序列合并为一个：<code>\u1e68</code>（S 有两个点）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;S\u0307\u0323&quot;</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&quot;S\u0307\u0323&quot;</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;\u1e68&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>事实上，情况并非总是如此，因为符号 <code>Ṩ</code> 是“常用”的，所以 UTF-16 创建者把它包含在主表中并给它了对应的代码。</p> <h3 id="_5-4-数组"><a href="#_5-4-数组" class="header-anchor">#</a> 5.4 数组</h3> <p>特殊的数据结构数组（<code>Array</code>）是一种 <strong>有序集合</strong>，里面的元素都是按顺序排列的</p> <h4 id="_5-4-1-声明数组"><a href="#_5-4-1-声明数组" class="header-anchor">#</a> 5.4.1 声明数组</h4> <p>创建一个空数组有两种语法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_5-4-2-简单使用数组"><a href="#_5-4-2-简单使用数组" class="header-anchor">#</a> 5.4.2 简单使用数组</h4> <p>数组元素从 0 开始编号。</p> <p>我们可以通过方括号中的数字获取元素：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Plum&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> fruits<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Apple</span>
<span class="token function">alert</span><span class="token punctuation">(</span> fruits<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Orange</span>
<span class="token function">alert</span><span class="token punctuation">(</span> fruits<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Plum</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>可以替换元素：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>fruits<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Pear'</span><span class="token punctuation">;</span> <span class="token comment">// 现在变成了 [&quot;Apple&quot;, &quot;Orange&quot;, &quot;Pear&quot;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>……或者向数组新加一个元素：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>fruits<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Lemon'</span><span class="token punctuation">;</span> <span class="token comment">// 现在变成 [&quot;Apple&quot;, &quot;Orange&quot;, &quot;Pear&quot;, &quot;Lemon&quot;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>length</code> 属性的值是数组中元素的总个数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Plum&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> fruits<span class="token punctuation">.</span>length <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>也可以用 <code>alert</code> 来显示整个数组。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Plum&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> fruits <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Apple,Orange,Plum</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>数组可以存储任何类型的元素。</p> <p>例如:</p> <div class="language-js no-beautify line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 混合值</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">'Apple'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'John'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 获取索引为 1 的对象然后显示它的 name</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John</span>
<span class="token comment">// 获取索引为 3 的函数并执行</span>
arr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// hello</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_5-4-3-使用-at-获取最后一个元素"><a href="#_5-4-3-使用-at-获取最后一个元素" class="header-anchor">#</a> 5.4.3 使用 &quot;at&quot; 获取最后一个元素</h4> <p>假设我们想要数组的最后一个元素。</p> <p>一些编程语言允许我们使用负数索引来实现这一点，例如 <code>fruits[-1]</code>。</p> <p>但在 JavaScript 中这行不通。结果将是 <code>undefined</code>，因为方括号中的索引是被按照其字面意思处理的。</p> <p>我们可以显式地计算最后一个元素的索引，然后访问它：<code>fruits[fruits.length - 1]</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Plum&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> fruits<span class="token punctuation">[</span>fruits<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Plum</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>有一个更简短的语法 <code>fruits.at(-1)</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Plum&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 与 fruits[fruits.length-1] 相同</span>
<span class="token function">alert</span><span class="token punctuation">(</span> fruits<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Plum</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>换句话说，<code>arr.at(i)</code>：</p> <ul><li>如果 <code>i &gt;= 0</code>，则与 <code>arr[i]</code> 完全相同。</li> <li>对于 <code>i</code> 为负数的情况，它则从数组的尾部向前数。</li></ul> <h4 id="_5-4-4-pop-push-shift-unshift-方法"><a href="#_5-4-4-pop-push-shift-unshift-方法" class="header-anchor">#</a> 5.4.4 pop/push, shift/unshift 方法</h4> <p><a href="https://en.wikipedia.org/wiki/Queue_(abstract_data_type)" target="_blank" rel="noopener noreferrer">队列（queue）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是最常见的使用数组的方法之一。在计算机科学中，这表示支持两个操作的一个有序元素的集合：</p> <ul><li><code>push</code> 在末端添加一个元素.</li> <li><code>shift</code> 取出队列首端的一个元素，整个队列往前移，这样原先排第二的元素现在排在了第一</li></ul> <p>数组还有另一个用例，就是数据结构 <a href="https://en.wikipedia.org/wiki/Stack_(abstract_data_type)" target="_blank" rel="noopener noreferrer">栈<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>它支持两种操作：</p> <ul><li><code>push</code> 在末端添加一个元素.</li> <li><code>pop</code> 从末端取出一个元素.</li></ul> <p>所以新元素的添加和取出都是从“末端”开始的。</p> <p>JavaScript 中的数组既可以用作队列，也可以用作栈。它们允许你从首端/末端来添加/删除元素。</p> <p>这在计算机科学中，允许这样的操作的数据结构被称为 <a href="https://en.wikipedia.org/wiki/Double-ended_queue" target="_blank" rel="noopener noreferrer">双端队列（deque）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p><strong>作用于数组末端的方法：</strong></p> <p><code>pop</code>
: 取出并返回数组的最后一个元素：</p> <div class="language- extra-class"><pre><code>```js
let fruits = [&quot;Apple&quot;, &quot;Orange&quot;, &quot;Pear&quot;];
alert( fruits.pop() ); // 移除 &quot;Pear&quot; 然后 alert 显示出来
alert( fruits ); // Apple, Orange
```

`fruits.pop()` 和 `fruits.at(-1)` 都返回数组的最后一个元素，但 `fruits.pop()` 同时也删除了数组的最后一个元素，进而修改了原数组。
</code></pre></div><p><code>push</code>
: 在数组末端添加元素：</p> <div class="language- extra-class"><pre><code>```js
let fruits = [&quot;Apple&quot;, &quot;Orange&quot;];
fruits.push(&quot;Pear&quot;);
alert( fruits ); // Apple, Orange, Pear
```

调用 `fruits.push(...)` 与 `fruits[fruits.length] = ...` 是一样的。
</code></pre></div><p><strong>作用于数组首端的方法：</strong></p> <p><code>shift</code>
: 取出数组的第一个元素并返回它：</p> <div class="language- extra-class"><pre><code>```js
let fruits = [&quot;Apple&quot;, &quot;Orange&quot;, &quot;Pear&quot;];
alert( fruits.shift() ); // 移除 Apple 然后 alert 显示出来
alert( fruits ); // Orange, Pear
```
</code></pre></div><p><code>unshift</code>
: 在数组的首端添加元素：</p> <div class="language- extra-class"><pre><code>```js
let fruits = [&quot;Orange&quot;, &quot;Pear&quot;];
fruits.unshift('Apple');
alert( fruits ); // Apple, Orange, Pear
```
</code></pre></div><p><code>push</code> 和 <code>unshift</code> 方法都可以一次添加多个元素：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Apple&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
fruits<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;Orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Peach&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fruits<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token string">&quot;Pineapple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Lemon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [&quot;Pineapple&quot;, &quot;Lemon&quot;, &quot;Apple&quot;, &quot;Orange&quot;, &quot;Peach&quot;]</span>
<span class="token function">alert</span><span class="token punctuation">(</span> fruits <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_5-4-5-数组原理"><a href="#_5-4-5-数组原理" class="header-anchor">#</a> 5.4.5 数组原理</h4> <p>数组是一种特殊的对象。使用方括号来访问属性 <code>arr[0]</code> 实际上是来自于对象的语法。它其实与 <code>obj[key]</code> 相同，其中 <code>arr</code> 是对象，而数字用作键（key）。</p> <p>它们扩展了对象，提供了特殊的方法来处理有序的数据集合以及 <code>length</code> 属性。但从本质上讲，它仍然是一个对象。</p> <p>记住，在 JavaScript 中只有 8 种基本的数据类型。数组是一个对象，因此其行为也像一个对象。</p> <p>数组真正特殊的是它们的内部实现。JavaScript 引擎尝试把这些元素一个接一个地存储在连续的内存区域，就像本章的插图显示的一样，而且还有一些其它的优化，以使数组运行得非常快。</p> <p>但是，如果我们不像“有序集合”那样使用数组，而是像常规对象那样使用数组，这些就都不生效了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个数组</span>
fruits<span class="token punctuation">[</span><span class="token number">99999</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 分配索引远大于数组长度的属性</span>
fruits<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个具有任意名称的属性</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这是可以的，因为数组是基于对象的。我们可以给它们添加任何属性。</p> <p>但是 Javascript 引擎会发现，我们在像使用常规对象一样使用数组，那么针对数组的优化就不再适用了，然后对应的优化就会被关闭，这些优化所带来的优势也就荡然无存了。</p> <p>数组误用的几种方式:</p> <ul><li>添加一个非数字的属性，比如 <code>arr.test = 5</code>。</li> <li>制造空洞，比如：添加 <code>arr[0]</code>，然后添加 <code>arr[1000]</code> (它们中间什么都没有)。</li> <li>以倒序填充数组，比如 <code>arr[1000]</code>，<code>arr[999]</code> 等等。</li></ul> <p>请将数组视为作用于 <strong>有序数据</strong> 的特殊结构。它们为此提供了特殊的方法。数组在 JavaScript 引擎内部是经过特殊调整的，使得更好地作用于连续的有序数据，所以请以正确的方式使用数组。如果你需要任意键值，那很有可能实际上你需要的是常规对象 <code>{}</code></p> <h4 id="_5-4-6-数组性能"><a href="#_5-4-6-数组性能" class="header-anchor">#</a> 5.4.6 数组性能</h4> <p><code>push/pop</code> 方法运行的比较快，而 <code>shift/unshift</code> 比较慢</p> <p><code>shift</code> 操作必须做三件事:</p> <ol><li>移除索引为 <code>0</code> 的元素。</li> <li>把所有的元素向左移动，把索引 <code>1</code> 改成 <code>0</code>，<code>2</code> 改成 <code>1</code> 以此类推，对其重新编号。</li> <li>更新 <code>length</code> 属性。</li></ol> <p><img src="array-shift.svg" alt=""></p> <p><strong>数组里的元素越多，移动它们就要花越多的时间，也就意味着越多的内存操作。</strong></p> <p><code>unshift</code> 也是一样：为了在数组的首端添加元素，我们首先需要将现有的元素向右移动，增加它们的索引值。</p> <p><code>push/pop</code> 不需要移动任何东西。如果从末端移除一个元素，<code>pop</code> 方法只需要清理索引值并缩短 <code>length</code> 就可以了</p> <p><strong><code>pop</code> 和<code>push</code>方法不需要移动任何东西，因为其它元素都保留了各自的索引。这就是为什么 <code>pop</code> 和<code>push</code> 会特别快。</strong></p> <h4 id="_5-4-7-数组循环"><a href="#_5-4-7-数组循环" class="header-anchor">#</a> 5.4.7 数组循环</h4> <p>遍历数组最古老的方式就是 <code>for</code> 循环：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pear&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">*</span><span class="token operator">/</span><span class="token operator">!</span><span class="token operator">*</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>但对于数组来说还有另一种循环方式，<code>for..of</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Plum&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 遍历数组元素</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> fruit <span class="token keyword">of</span> fruits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> fruit <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>for..of</code> 不能获取当前元素的索引，只是获取元素值</p> <p>技术上来讲，因为数组也是对象，所以使用 <code>for..in</code> 也是可以的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pear&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">*</span><span class="token operator">/</span><span class="token operator">!</span><span class="token operator">*</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Apple, Orange, Pear</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>但这其实是一个很不好的想法。会有一些潜在问题存在：</p> <ol><li><p><code>for..in</code> 循环会遍历 <strong>所有属性</strong>，不仅仅是这些数字属性。</p> <p>在浏览器和其它环境中有一种称为“类数组”的对象，它们 <strong>看似是数组</strong>。也就是说，它们有 <code>length</code> 和索引属性，但是也可能有其它的非数字的属性和方法，这通常是我们不需要的。<code>for..in</code> 循环会把它们都列出来。所以如果我们需要处理类数组对象，这些“额外”的属性就会存在问题。</p></li> <li><p><code>for..in</code> 循环适用于普通对象，并且做了对应的优化。但是不适用于数组，因此速度要慢 10-100 倍。当然即使是这样也依然非常快。只有在遇到瓶颈时可能会有问题。但是我们仍然应该了解这其中的不同。</p></li></ol> <p>通常来说，我们不应该用 <code>for..in</code> 来处理数组。</p> <h4 id="_5-4-8-数组-length"><a href="#_5-4-8-数组-length" class="header-anchor">#</a> 5.4.8 数组 &quot;length&quot;</h4> <p>当我们修改数组的时候，<code>length</code> 属性会自动更新。它实际上不是数组里元素的个数，而是最大的数字索引值加一。</p> <p>例如，一个数组只有一个元素，但是这个元素的索引值很大，那么这个数组的 <code>length</code> 也会很大：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
fruits<span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Apple&quot;</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> fruits<span class="token punctuation">.</span>length <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 124</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>length</code> 属性的另一个有意思的点是它是可写的。</p> <p>如果我们手动增加它，则不会发生任何有趣的事儿。但是如果我们减少它，数组就会被截断。该过程是不可逆的，下面是例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 截断到只剩 2 个元素</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1, 2]</span>
arr<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 又把 length 加回来</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined：被截断的那些数值并没有回来</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>所以，清空数组最简单的方法就是：<code>arr.length = 0;</code></p> <h4 id="_5-4-9-new-array"><a href="#_5-4-9-new-array" class="header-anchor">#</a> 5.4.9 new Array()</h4> <p>创建数组的另一种语法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token string">&quot;Apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Pear&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;etc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果使用单个参数（即数字）调用 <code>new Array</code>，那么它会创建一个 <strong>指定了长度，却没有任何项</strong> 的数组。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 会创建一个 [2] 的数组吗？</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined！没有元素。</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">.</span>length <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// length 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_5-4-10-多维数组"><a href="#_5-4-10-多维数组" class="header-anchor">#</a> 5.4.10 多维数组</h4> <p>数组里的项也可以是数组。我们可以将其用于多维数组，例如存储矩阵：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> matrix <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> matrix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 最中间的那个数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_5-4-11-tostring"><a href="#_5-4-11-tostring" class="header-anchor">#</a> 5.4.11 toString</h4> <p>数组有自己的 <code>toString</code> 方法的实现，会返回以逗号隔开的元素列表。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1,2,3</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token function">String</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'1,2,3'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>此外，我们试试运行一下这个：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;1&quot;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;11&quot;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;1,21&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>数组没有 <code>Symbol.toPrimitive</code>，也没有 <code>valueOf</code>，它们只能执行 <code>toString</code> 进行转换，所以这里 <code>[]</code> 就变成了一个空字符串，<code>[1]</code> 变成了 <code>&quot;1&quot;</code>，<code>[1,2]</code> 变成了 <code>&quot;1,2&quot;</code>。</p> <h4 id="_5-4-12-不要使用-比较数组"><a href="#_5-4-12-不要使用-比较数组" class="header-anchor">#</a> 5.4.12 不要使用 == 比较数组</h4> <p>该运算符不会对数组进行特殊处理，它会像处理任意对象那样处理数组。</p> <ul><li>仅当两个对象引用的是同一个对象时，它们才相等 <code>==</code>。</li> <li>如果 <code>==</code> 左右两个参数之中有一个参数是对象，另一个参数是原始类型，那么该对象将会被转换为原始类型</li> <li>……<code>null</code> 和 <code>undefined</code> 相等 <code>==</code>，且各自不等于任何其他的值。</li></ul> <p>严格比较 <code>===</code> 更简单，因为它不会进行类型转换。</p> <p>所以，如果我们使用 <code>==</code> 来比较数组，除非我们比较的是两个引用同一数组的变量，否则它们永远不相等。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>从技术上讲，这些数组是不同的对象。所以它们不相等。<code>==</code> 运算符不会进行逐项比较。</p> <p>与原始类型的比较也可能会产生看似很奇怪的结果：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'0'</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token comment">// 在 [] 被转换为 '' 后</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token string">''</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true，因为 '' 被转换成了数字 0</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'0'</span> <span class="token operator">==</span> <span class="token string">''</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false，没有进一步的类型转换，是不同的字符串</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在这里的两个例子中，我们将原始类型和数组对象进行比较。因此，数组 <code>[]</code> 被转换为原始类型以进行比较，被转换成了一个空字符串 <code>''</code>。</p> <h3 id="_5-5-数组方法"><a href="#_5-5-数组方法" class="header-anchor">#</a> 5.5 数组方法</h3> <h4 id="_5-5-1-添加-移除数组元素"><a href="#_5-5-1-添加-移除数组元素" class="header-anchor">#</a> 5.5.1 添加/移除数组元素</h4> <ul><li><code>arr.push(...items)</code> —— 从尾端添加元素，</li> <li><code>arr.pop()</code> —— 从尾端提取元素，</li> <li><code>arr.shift()</code> —— 从首端提取元素，</li> <li><code>arr.unshift(...items)</code> —— 从首端添加元素。</li></ul> <h5 id="splice"><a href="#splice" class="header-anchor">#</a> splice</h5> <p>因为 <code>delete</code>方法是通过 <code>key</code> 来移除对应的值。对于对象来说是可以的。但是对于数组来说，我们希望剩下的元素能够移动并占据被释放的位置，否则length属性是不会自动变化的</p> <p><a href="mdn:js/Array/splice">arr.splice</a> 方法可以说是处理数组的瑞士军刀。它可以做所有事情：添加，删除和插入元素。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>start<span class="token punctuation">[</span><span class="token punctuation">,</span> deleteCount<span class="token punctuation">,</span> elem1<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">,</span> elemN<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>它从索引 <code>start</code> 开始修改 <code>arr</code>：删除 <code>deleteCount</code> 个元素并在当前位置插入 <code>elem1, ..., elemN</code>。最后返回已被删除元素的数组。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;study&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;JavaScript&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;right&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;now&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 删除数组的前三项，并使用其他内容代替它们</span>
<span class="token keyword">let</span> removed <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;Let's&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr <span class="token punctuation">)</span> <span class="token comment">// 现在 [&quot;Let's&quot;, &quot;dance&quot;, &quot;right&quot;, &quot;now&quot;]</span>
<span class="token function">alert</span><span class="token punctuation">(</span> removed <span class="token punctuation">)</span> <span class="token comment">//&quot;I&quot;, &quot;study&quot;, &quot;JavaScript&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">允许负向索引</p> <p>在这里和其他数组方法中，负向索引都是被允许的。它们从数组末尾计算位置，如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 从索引 -1（尾端前一位）</span>
<span class="token comment">// 删除 0 个元素，</span>
<span class="token comment">// 然后插入 3 和 4</span>
arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1,2,3,4,5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div> <h5 id="slice"><a href="#slice" class="header-anchor">#</a> slice</h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>end<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>它会返回一个新数组，将所有从索引 <code>start</code> 到 <code>end</code>（不包括 <code>end</code>）的数组项复制到一个新的数组。<code>start</code> 和 <code>end</code> 都可以是负数，在这种情况下，从末尾计算索引。</p> <p>它和字符串的 <code>str.slice</code> 方法有点像，就是把子字符串替换成子数组</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;e&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;s&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;t&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// e,s（复制从位置 1 到位置 3 的元素）</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// s,t（复制从位置 -2 到尾端的元素）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>我们也可以不带参数地调用它：<code>arr.slice()</code> 会创建一个 <code>arr</code> 的副本。其通常用于获取副本，以进行不影响原始数组的进一步转换。</p> <h5 id="concat"><a href="#concat" class="header-anchor">#</a> concat</h5> <p><a href="mdn:js/Array/concat">arr.concat</a> 创建一个新数组，其中包含来自于其他数组和其他项的值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token operator">...</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>它接受任意数量的参数 —— 数组或值都可以。结果是一个包含来自于 <code>arr</code>，然后是 <code>arg1</code>，<code>arg2</code> 的元素的新数组。</p> <p>如果参数 <code>argN</code> 是一个数组，那么其中的所有元素都会被复制。否则，将复制参数本身。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// create an array from: arr and [3,4]</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1,2,3,4</span>
<span class="token comment">// create an array from: arr and [3,4] and [5,6]</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1,2,3,4,5,6</span>
<span class="token comment">// create an array from: arr and [3,4], then add values 5 and 6</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1,2,3,4,5,6</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>通常，它只复制数组中的元素。其他对象，即使它们看起来像数组一样，但仍然会被作为一个整体添加：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arrayLike <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">0</span><span class="token operator">:</span> <span class="token string">&quot;something&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arrayLike<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1,2,[object Object]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>……但是，如果类似数组的对象具有 <code>Symbol.isConcatSpreadable</code> 属性，那么它就会被 <code>concat</code> 当作一个数组来处理：此对象中的元素将被添加：</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arrayLike <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">0</span><span class="token operator">:</span> <span class="token string">&quot;something&quot;</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token string">&quot;else&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>isConcatSpreadable<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arrayLike<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1,2,something,else</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_5-5-2-遍历-foreach"><a href="#_5-5-2-遍历-foreach" class="header-anchor">#</a> 5.5.2 遍历：forEach</h4> <p><a href="mdn:js/Array/forEach">arr.forEach</a> 方法允许为数组的每个元素都运行一个函数。</p> <p>语法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... do something with item</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token string">&quot;Bilbo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Gandalf&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Nazgul&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is at index </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>array<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>该函数的结果（如果它有返回）会被抛弃和忽略</p> <h4 id="_5-5-3-搜索数组"><a href="#_5-5-3-搜索数组" class="header-anchor">#</a> 5.5.3 搜索数组</h4> <h5 id="indexof-lastindexof-和-includes"><a href="#indexof-lastindexof-和-includes" class="header-anchor">#</a> indexOf/lastIndexOf 和 includes</h5> <p><a href="mdn:js/Array/indexOf">arr.indexOf</a> 和 <a href="mdn:js/Array/includes">arr.includes</a> 方法语法相似，并且作用基本上也与字符串的方法相同，只不过这里是对数组元素而不是字符进行操作：</p> <ul><li><code>arr.indexOf(item, from)</code> 从索引 <code>from</code> 开始搜索 <code>item</code>，如果找到则返回索引，否则返回 <code>-1</code>。</li> <li><code>arr.includes(item, from)</code> —— 从索引 <code>from</code> 开始搜索 <code>item</code>，如果找到则返回 <code>true</code>（译注：如果没找到，则返回 <code>false</code>）。</li></ul> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>请注意，<code>indexOf</code> 使用严格相等 <code>===</code> 进行比较。所以，如果我们搜索 <code>false</code>，它会准确找到 <code>false</code> 而不是数字 <code>0</code>。</p></div> <p>如果我们想检查数组中是否包含元素 <code>item</code>，并且不需要知道其确切的索引，那么 <code>arr.includes</code> 是首选。</p> <p>方法 <a href="mdn:js/Array/lastIndexOf">arr.lastIndexOf</a> 与 <code>indexOf</code> 相同，但从右向左查找。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Apple'</span><span class="token punctuation">,</span> <span class="token string">'Orange'</span><span class="token punctuation">,</span> <span class="token string">'Apple'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'Apple'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0（第一个 Apple）</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'Apple'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2（最后一个 Apple）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">方法 `includes` 可以正确的处理 `NaN`</p> <p>方法 <code>includes</code> 的一个次要但值得注意的特性是，它可以正确处理 <code>NaN</code>，这与 <code>indexOf</code> 不同：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">NaN</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -1（错，应该为 0）</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true（正确）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这是因为 <code>includes</code> 是在比较晚的时候才被添加到 JavaScript 中的，并且在内部使用了更新了的比较算法。</p></div> <h5 id="find-和-findindex-findlastindex"><a href="#find-和-findindex-findlastindex" class="header-anchor">#</a> find 和 findIndex/findLastIndex</h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> result <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果返回 true，则返回 item 并停止迭代</span>
  <span class="token comment">// 对于假值（false）的情况，则返回 undefined</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>依次对数组中的每个元素调用该函数：</p> <ul><li><code>item</code> 是元素。</li> <li><code>index</code> 是它的索引。</li> <li><code>array</code> 是数组本身。</li></ul> <p>如果它返回 <code>true</code>，则搜索停止，并返回 <code>item</code>。如果没有搜索到，则返回 <code>undefined</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> users <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Pete&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Mary&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><a href="mdn:js/Array/findIndex">arr.findIndex</a> 方法（与 <code>arr.find</code>）具有相同的语法，但它返回找到的元素的索引，而不是元素本身。如果没找到，则返回 <code>-1</code>。</p> <p><a href="mdn:js/Array/findLastIndex">arr.findLastIndex</a> 方法类似于 <code>findIndex</code>，但从右向左搜索，类似于 <code>lastIndexOf</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> users <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Pete&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Mary&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 寻找第一个 John 的索引</span>
<span class="token function">alert</span><span class="token punctuation">(</span>users<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> user<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'John'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
<span class="token comment">// 寻找最后一个 John 的索引</span>
<span class="token function">alert</span><span class="token punctuation">(</span>users<span class="token punctuation">.</span><span class="token function">findLastIndex</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> user<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'John'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="filter"><a href="#filter" class="header-anchor">#</a> filter</h5> <p><code>filter</code> 语法与 <code>find</code> 大致相同，但是返回的是所有匹配元素组成的数组：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> results <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果 true item 被 push 到 results，迭代继续</span>
  <span class="token comment">// 如果什么都没找到，则返回空数组</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> users <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Pete&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Mary&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 返回前两个用户的数组</span>
<span class="token keyword">let</span> someUsers <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>someUsers<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_5-5-4-转换数组"><a href="#_5-5-4-转换数组" class="header-anchor">#</a> 5.5.4 转换数组</h4> <h5 id="map"><a href="#map" class="header-anchor">#</a> map</h5> <p><a href="mdn:js/Array/map">arr.map</a> 对数组的每个元素都调用函数，并返回结果数组。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> result <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 返回新值而不是当前元素</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> lengths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Bilbo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Gandalf&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Nazgul&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>lengths<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5,7,6</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="sort-fn"><a href="#sort-fn" class="header-anchor">#</a> sort(fn)</h5> <p><a href="mdn:js/Array/sort">arr.sort</a> 方法对数组进行 <strong>原位（in-place）</strong> 排序，更改元素的顺序。(译注：原位是指在此数组内，而非生成一个新数组。)</p> <p>它还返回排序后的数组，但是返回值通常会被忽略，因为修改了 <code>arr</code> 本身。</p> <p>语法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 该方法重新排列 arr 的内容</span>
arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1, 15, 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>这些元素默认情况下被按字符串进行排序。</strong></p> <p>从字面上看，所有元素都被转换为字符串，然后进行比较。对于字符串，按照词典顺序进行排序，实际上应该是 <code>&quot;2&quot; &gt; &quot;15&quot;</code>。</p> <p>要使用我们自己的排序顺序，我们需要提供一个函数作为 <code>arr.sort()</code> 的参数。</p> <p>该函数应该比较两个任意值并返回：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&gt;</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 如果第一个值比第二个值大</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 如果两个值相等</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&lt;</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 如果第一个值比第二个值小</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>例如，按数字进行排序：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">compareNumeric</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&gt;</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&lt;</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>compareNumeric<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1, 2, 15</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>现在结果符合预期了。</p> <p><code>arr</code> 可以是由任何内容组成的数组，它可能包含数字、字符串、对象或其他任何内容。我们有一组 <strong>一些元素</strong>。要对其进行排序，我们需要一个 <strong>排序函数</strong> 来确认如何比较这些元素。默认是按字符串进行排序的。</p> <p><code>arr.sort(fn)</code> 方法实现了通用的排序算法。我们不需要关心它的内部工作原理（大多数情况下都是经过 <a href="https://en.wikipedia.org/wiki/Quicksort" target="_blank" rel="noopener noreferrer">快速排序<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 或 <a href="https://en.wikipedia.org/wiki/Timsort" target="_blank" rel="noopener noreferrer">Timsort<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 算法优化的）。它将遍历数组，使用提供的函数比较其元素并对其重新排序，我们所需要的就是提供执行比较的函数 <code>fn</code>。</p> <div class="custom-block tip"><p class="custom-block-title">比较函数可以返回任何数字</p> <p>实际上，比较函数只需要返回一个正数表示“大于”，一个负数表示“小于”。
通过这个原理我们可以编写更短的函数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// *!*1, 2, 15*/!*</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <div class="custom-block tip"><p class="custom-block-title">用 `localeCompare` for strings</p> <p>字符串比较默认情况下，它通过字母的代码比较字母。
对于许多字母，最好使用 <code>str.localeCompare</code> 方法正确地对字母进行排序，例如 <code>Ö</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> countries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Österreich'</span><span class="token punctuation">,</span> <span class="token string">'Andorra'</span><span class="token punctuation">,</span> <span class="token string">'Vietnam'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> countries<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">&gt;</span> b <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Andorra, Vietnam, Österreich（错的）</span>
<span class="token function">alert</span><span class="token punctuation">(</span> countries<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Andorra,Österreich,Vietnam（对的！）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <h5 id="reverse"><a href="#reverse" class="header-anchor">#</a> reverse</h5> <p><a href="mdn:js/Array/reverse">arr.reverse</a> 方法用于颠倒 <code>arr</code> 中元素的顺序。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> arr <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5,4,3,2,1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>它也会返回颠倒后的数组 <code>arr</code></p> <h5 id="split-和-join"><a href="#split-和-join" class="header-anchor">#</a> split 和 join</h5> <p><a href="mdn:js/String/split">str.split(delim)</a> 通过给定的分隔符 <code>delim</code> 将字符串分割成一个数组。</p> <p><code>split</code> 方法有一个可选的第二个数字参数 —— 对数组长度的限制。如果提供了，那么额外的元素会被忽略。但实际上它很少使用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token string">'Bilbo, Gandalf, Nazgul, Saruman'</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Bilbo, Gandalf</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><a href="mdn:js/Array/join">arr.join(glue)</a> 与 <code>split</code> 相反。它会在它们之间创建一串由 <code>glue</code> 粘合的 <code>arr</code> 项。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Bilbo'</span><span class="token punctuation">,</span> <span class="token string">'Gandalf'</span><span class="token punctuation">,</span> <span class="token string">'Nazgul'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用分号 ; 将数组粘合成字符串</span>
<span class="token function">alert</span><span class="token punctuation">(</span> str <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Bilbo;Gandalf;Nazgul</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="reduce-reduceright"><a href="#reduce-reduceright" class="header-anchor">#</a> reduce/reduceRight</h5> <p><a href="mdn:js/Array/reduce">arr.reduce</a> 方法和 <a href="mdn:js/Array/reduceRight">arr.reduceRight</a> 用于根据数组计算单个值。</p> <p>语法是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> value <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">accumulator<span class="token punctuation">,</span> item<span class="token punctuation">,</span> index<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>initial<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>该函数一个接一个地应用于所有数组元素，并将其结果“搬运（carry on）”到下一个调用。</p> <p>参数：</p> <ul><li><code>accumulator</code> —— 是上一个函数调用的结果，第一次等于  <code>initial</code>（如果提供了 <code>initial</code> 的话）。</li> <li><code>item</code> —— 当前的数组元素。</li> <li><code>index</code> —— 当前索引。</li> <li><code>arr</code> —— 数组本身。</li></ul> <p>应用函数时，上一个函数调用的结果将作为第一个参数传递给下一个函数。因此，第一个参数本质上是累加器，用于存储所有先前执行的组合结果。最后，它成为 <code>reduce</code> 的结果。</p> <p>在这里，我们通过一行代码得到一个数组的总和：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sum<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sum <span class="token operator">+</span> current<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>让我们看看细节，到底发生了什么。</p> <ol><li>在第一次运行时，<code>sum</code> 的值为初始值 <code>initial</code>（<code>reduce</code> 的最后一个参数），等于 0，<code>current</code> 是第一个数组元素，等于 <code>1</code>。所以函数运行的结果是 <code>1</code>。</li> <li>在第二次运行时，<code>sum = 1</code>，我们将第二个数组元素（<code>2</code>）与其相加并返回。</li> <li>在第三次运行中，<code>sum = 3</code>，我们继续把下一个元素与其相加，以此类推……</li></ol> <p>计算流程：
每一行代表的是对下一个数组元素的函数调用：</p> <table><thead><tr><th></th> <th><code>sum</code></th> <th><code>current</code></th> <th><code>result</code></th></tr></thead> <tbody><tr><td>第 1 次调用</td> <td><code>0</code></td> <td><code>1</code></td> <td><code>1</code></td></tr> <tr><td>第 2 次调用</td> <td><code>1</code></td> <td><code>2</code></td> <td><code>3</code></td></tr> <tr><td>第 3 次调用</td> <td><code>3</code></td> <td><code>3</code></td> <td><code>6</code></td></tr> <tr><td>第 4 次调用</td> <td><code>6</code></td> <td><code>4</code></td> <td><code>10</code></td></tr> <tr><td>第 5 次调用</td> <td><code>10</code></td> <td><code>5</code></td> <td><code>15</code></td></tr></tbody></table> <p>我们也可以省略初始值：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 删除 reduce 的初始值（没有 0）</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sum<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sum <span class="token operator">+</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> result <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>结果是一样的。这是因为如果没有初始值，那么 <code>reduce</code> 会将数组的第一个元素作为初始值，并从第二个元素开始迭代。</p> <p>但是这种使用需要非常小心。如果数组为空，那么在没有初始值的情况下调用 <code>reduce</code> 会导致错误。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// Error: Reduce of empty array with no initial value</span>
<span class="token comment">// 如果初始值存在，则 reduce 将为空 arr 返回它（即这个初始值）。</span>
arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sum<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sum <span class="token operator">+</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>所以建议始终指定初始值。</p> <p><a href="mdn:js/Array/reduceRight">arr.reduceRight</a> 和 <a href="mdn:js/Array/reduce">arr.reduce</a> 方法的功能一样，只是遍历为从右到左。</p> <h4 id="_5-5-5-array-isarray"><a href="#_5-5-5-array-isarray" class="header-anchor">#</a> 5.5.5 Array.isArray</h4> <p>数组是基于对象的，不构成单独的语言类型。</p> <p>所以 <code>typeof</code> 不能帮助从数组中区分出普通对象：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// object</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// object（相同）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>……但是数组经常被使用，因此有一种特殊的方法用于判断：<a href="mdn:js/Array/isArray">Array.isArray(value)</a>。如果 <code>value</code> 是一个数组，则返回 <code>true</code>；否则返回 <code>false</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">alert</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token function">alert</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_5-5-6-大多数方法都支持-thisarg"><a href="#_5-5-6-大多数方法都支持-thisarg" class="header-anchor">#</a> 5.5.6 大多数方法都支持 &quot;thisArg&quot;</h4> <p>几乎所有调用函数的数组方法 —— 比如 <code>find</code>，<code>filter</code>，<code>map</code>，除了 <code>sort</code> 是一个特例，都接受一个可选的附加参数 <code>thisArg</code>。</p> <p>以下是这些方法的完整语法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>arr<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> thisArg<span class="token punctuation">)</span><span class="token punctuation">;</span>
arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> thisArg<span class="token punctuation">)</span><span class="token punctuation">;</span>
arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> thisArg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token comment">// thisArg 是可选的最后一个参数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>thisArg</code> 参数的值在 <code>func</code> 中变为 <code>this</code>。</p> <p>例如，在这里我们使用 <code>army</code> 对象方法作为过滤器，<code>thisArg</code> 用于传递上下文（passes the context）：</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">let</span> army <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">minAge</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
  <span class="token literal-property property">maxAge</span><span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">,</span>
  <span class="token function">canJoin</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> user<span class="token punctuation">.</span>age <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minAge <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>age <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxAge<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> users <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 找到 army.canJoin 返回 true 的 user</span>
<span class="token keyword">let</span> soldiers <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>army<span class="token punctuation">.</span>canJoin<span class="token punctuation">,</span> army<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>soldiers<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token function">alert</span><span class="token punctuation">(</span>soldiers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>
<span class="token function">alert</span><span class="token punctuation">(</span>soldiers<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 23</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>如果在上面的示例中我们使用了 <code>users.filter(army.canJoin)</code>，那么 <code>army.canJoin</code> 将被作为独立函数调用，并且这时 <code>this=undefined</code>，从而会导致即时错误。</p> <h3 id="_5-6-可迭代对象"><a href="#_5-6-可迭代对象" class="header-anchor">#</a> 5.6 可迭代对象</h3> <p><strong>可迭代（Iterable）</strong> 对象是数组的泛化。这个概念是说任何对象都可以被定制为可在 <code>for..of</code> 循环中使用的对象。</p> <h4 id="_5-6-1-symbol-iterator"><a href="#_5-6-1-symbol-iterator" class="header-anchor">#</a> 5.6.1 Symbol.iterator</h4> <p>为了让一个自己创建的对象可迭代（也就让 <code>for..of</code> 可以运行）我们需要为对象添加一个名为 <code>Symbol.iterator</code> 的方法（一个专门用于使对象可迭代的内建 symbol）。</p> <ol><li>当 <code>for..of</code> 循环启动时，它会调用这个方法（如果没找到，就会报错）。这个方法必须返回一个 <strong>迭代器（iterator）</strong> —— 一个有 <code>next</code> 方法的对象。</li> <li>从此开始，<code>for..of</code> <strong>仅适用于这个被返回的对象</strong>。</li> <li>当 <code>for..of</code> 循环希望取得下一个数值，它就调用这个对象的 <code>next()</code> 方法。</li> <li><code>next()</code> 方法返回的结果的格式必须是 <code>{done: Boolean, value: any}</code>，当 <code>done=true</code> 时，表示循环结束，否则 <code>value</code> 是下一个值。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> range <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token number">5</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 1. for..of 调用首先会调用这个：</span>
range<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ……它返回迭代器对象（iterator object）：</span>
  <span class="token comment">// 2. 接下来，for..of 仅与下面的迭代器对象一起工作，要求它提供下一个值</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">current</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>from<span class="token punctuation">,</span>
    <span class="token literal-property property">last</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to<span class="token punctuation">,</span>
    <span class="token comment">// 3. next() 在 for..of 的每一轮循环迭代中被调用</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 4. 它将会返回 {done:.., value :...} 格式的对象</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>last<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 现在它可以运行了！</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> num <span class="token keyword">of</span> range<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1, 然后是 2, 3, 4, 5</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">关注点分离</p> <p>关注点分离是可迭代对象的核心功能</p> <ul><li><code>range</code> 自身没有 <code>next()</code> 方法。</li> <li>相反，是通过调用 <code>range[Symbol.iterator]()</code> 创建了另一个对象，即所谓的“迭代器”对象，并且它的 <code>next</code> 会为迭代生成值。</li></ul> <p>因此，迭代器对象和与其进行迭代的对象是分开的。</p> <p>从技术上说，我们可以将它们合并，并使用 <code>range</code> 自身作为迭代器来简化代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> range <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">from</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">to</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>from<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> num <span class="token keyword">of</span> range<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1, 然后是 2, 3, 4, 5</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>但缺点是，现在不可能同时在对象上运行两个 <code>for..of</code> 循环了：它们将共享迭代状态，因为只有一个迭代器，即对象本身。但是两个并行的 <code>for..of</code> 是很罕见的，即使在异步情况下</p></div> <div class="custom-block tip"><p class="custom-block-title">无穷迭代器（iterator）</p> <p>无穷迭代器也是可能的。例如，将 <code>range</code> 设置为 <code>range.to = Infinity</code>，这时 <code>range</code> 则成为了无穷迭代器。或者我们可以创建一个可迭代对象，它生成一个无穷伪随机数序列。也是可能的。</p> <p><code>next</code> 没有什么限制，它可以返回越来越多的值，这是正常的。</p> <p>当然，迭代这种对象的 <code>for..of</code> 循环将不会停止。但是我们可以通过使用 <code>break</code> 来停止它。</p></div> <h4 id="_5-6-2-字符串迭代"><a href="#_5-6-2-字符串迭代" class="header-anchor">#</a> 5.6.2 字符串迭代</h4> <p>数组和字符串是使用最广泛的内建可迭代对象。</p> <p>对于一个字符串，<code>for..of</code> 遍历它的每个字符：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> char <span class="token keyword">of</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 触发 4 次，每个字符一次</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> char <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// t, then e, then s, then t</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>对于代理对（surrogate pairs），它也能正常工作！（译注：这里的代理对也就指的是 UTF-16 的扩展字符）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'𝒳😂'</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> char <span class="token keyword">of</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span> char <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 𝒳，然后是 😂</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_5-6-3-显示调用迭代器"><a href="#_5-6-3-显示调用迭代器" class="header-anchor">#</a> 5.6.3 显示调用迭代器</h4> <p>不使用<code>for..of</code>，直接通过迭代器遍历字符串</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 和 for..of 做相同的事</span>
<span class="token comment">// for (let char of str) alert(char);</span>
<span class="token keyword">let</span> iterator <span class="token operator">=</span> str<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一个接一个地输出字符</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>很少需要我们这样做，但是比 <code>for..of</code> 给了我们更多的控制权。例如，我们可以拆分迭代过程：迭代一部分，然后停止，做一些其他处理，然后再恢复迭代。</p> <h4 id="_5-6-4-可迭代-iterable-和类数组-array-like"><a href="#_5-6-4-可迭代-iterable-和类数组-array-like" class="header-anchor">#</a> 5.6.4 可迭代（iterable）和类数组（array-like）</h4> <p>这两个官方术语看起来差不多，但其实大不相同。请确保你能够充分理解它们的含义，以免造成混淆。</p> <ul><li><strong>Iterable</strong> 如上所述，是实现了 <code>Symbol.iterator</code> 方法的对象。</li> <li><strong>Array-like</strong> 是有索引和 <code>length</code> 属性的对象，所以它们看起来很像数组。</li></ul> <p>可迭代对象和类数组对象通常都 <strong>不是数组</strong>，它们没有 <code>push</code> 和 <code>pop</code> 等方法</p> <h4 id="_5-6-5-array-from"><a href="#_5-6-5-array-from" class="header-anchor">#</a> 5.6.5 Array.from</h4> <p>有一个全局方法 <a href="mdn:js/Array/from">Array.from</a> 可以接受一个可迭代或类数组的值，并从中获取一个“真正的”数组。然后我们就可以对其调用数组方法了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arrayLike <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">0</span><span class="token operator">:</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arrayLike<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (*)</span>
<span class="token function">alert</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// World（pop 方法有效）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>Array.from</code> 的完整语法允许我们提供一个可选的“映射（mapping）”函数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token punctuation">,</span> mapFn<span class="token punctuation">,</span> thisArg<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可选的第二个参数 <code>mapFn</code> 可以是一个函数，该函数会在对象中的元素被添加到数组前，被应用于每个元素，此外 <code>thisArg</code> 允许我们为该函数设置 <code>this</code>。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 假设 range 来自上文例子中</span>
<span class="token comment">// 求每个数的平方</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>range<span class="token punctuation">,</span> <span class="token parameter">num</span> <span class="token operator">=&gt;</span> num <span class="token operator">*</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1,4,9,16,25</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_5-7-映射和集合"><a href="#_5-7-映射和集合" class="header-anchor">#</a> 5.7 映射和集合</h3> <h4 id="_5-7-1-map"><a href="#_5-7-1-map" class="header-anchor">#</a> 5.7.1 Map</h4> <p><a href="mdn:js/Map">Map</a> 是一个带键的数据项的集合，就像一个 <code>Object</code> 一样。 但是它们最大的差别是 <code>Map</code> 允许任何类型的键（key）。</p> <p>它的方法和属性如下：</p> <ul><li><code>new Map()</code> —— 创建 map。</li> <li><code>map.set(key, value)</code> —— 根据键存储值。</li> <li><code>map.get(key)</code> —— 根据键来返回值，如果 <code>map</code> 中不存在对应的 <code>key</code>，则返回 <code>undefined</code>。</li> <li><code>map.has(key)</code> —— 如果 <code>key</code> 存在则返回 <code>true</code>，否则返回 <code>false</code>。</li> <li><code>map.delete(key)</code> —— 删除指定键的值。</li> <li><code>map.clear()</code> —— 清空 map。</li> <li><code>map.size</code> —— 返回当前元素个数</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'str1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 字符串键</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'num1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 数字键</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'bool1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 布尔值键</span>
<span class="token comment">// 还记得普通的 Object 吗? 它会将键转化为字符串</span>
<span class="token comment">// Map 则会保留键的类型，所以下面这两个结果不同：</span>
<span class="token function">alert</span><span class="token punctuation">(</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'num1'</span>
<span class="token function">alert</span><span class="token punctuation">(</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'str1'</span>
<span class="token function">alert</span><span class="token punctuation">(</span> map<span class="token punctuation">.</span>size <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如我们所见，与对象不同，键不会被转换成字符串。键可以是任何类型</p> <div class="custom-block warning"><p class="custom-block-title">`map[key]` 不是使用 `Map` 的正确方式</p> <p>虽然 <code>map[key]</code> 也有效，例如我们可以设置 <code>map[key] = 2</code>，这样会将 <code>map</code> 视为 JavaScript 的 plain object，因此它暗含了所有相应的限制（仅支持 string/symbol 键等）。<br>
所以我们应该使用 <code>map</code> 方法：<code>set</code> 和 <code>get</code> 等。</p></div> <p><strong>Map 还可以使用对象作为键。</strong>
使用对象作为键是 <code>Map</code> 最值得注意和重要的功能之一。在 <code>Object</code> 中，我们则无法使用对象作为键。在 <code>Object</code> 中使用字符串作为键是可以的，但我们无法使用另一个 <code>Object</code> 作为 <code>Object</code> 中的键</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 存储每个用户的来访次数</span>
<span class="token keyword">let</span> visitsCountMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// john 是 Map 中的键</span>
visitsCountMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>john<span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> visitsCountMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>john<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 123</span>

<span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ben <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Ben&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> visitsCountObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 尝试使用对象</span>
visitsCountObj<span class="token punctuation">[</span>ben<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">234</span><span class="token punctuation">;</span> <span class="token comment">// 尝试将对象 ben 用作键</span>
visitsCountObj<span class="token punctuation">[</span>john<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span> <span class="token comment">// 尝试将对象 john 用作键，但我们会发现使用对象 ben 作为键存下的值会被替换掉</span>
<span class="token comment">// 变成这样了！</span>
<span class="token function">alert</span><span class="token punctuation">(</span> visitsCountObj<span class="token punctuation">[</span><span class="token string">&quot;[object Object]&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 123</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="map-比较键"><a href="#map-比较键" class="header-anchor">#</a> Map 比较键</h5> <p><code>Map</code> 使用 <a href="https://tc39.github.io/ecma262/#sec-samevaluezero" target="_blank" rel="noopener noreferrer">SameValueZero<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 算法来比较键是否相等。它和严格等于 <code>===</code> 差不多，但区别是 <code>NaN</code> 被看成是等于 <code>NaN</code>。所以 <code>NaN</code> 也可以被用作键。<br>
这个算法不能被改变或者自定义。</p> <h5 id="链式调用"><a href="#链式调用" class="header-anchor">#</a> 链式调用</h5> <p>每一次 <code>map.set</code> 调用都会返回 map 本身，所以我们可以进行“链式”调用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'str1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'num1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'bool1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_5-7-2-map-迭代"><a href="#_5-7-2-map-迭代" class="header-anchor">#</a> 5.7.2 Map 迭代</h4> <p>如果要在 <code>map</code> 里使用循环，可以使用以下三个方法：</p> <ul><li><code>map.keys()</code> —— 遍历并返回一个包含所有键的可迭代对象，</li> <li><code>map.values()</code> —— 遍历并返回一个包含所有值的可迭代对象，</li> <li><code>map.entries()</code> —— 遍历并返回一个包含所有实体 <code>[key, value]</code> 的可迭代对象，<code>for..of</code> 在默认情况下使用的就是这个。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> recipeMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">'cucumber'</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'tomatoes'</span><span class="token punctuation">,</span> <span class="token number">350</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'onion'</span><span class="token punctuation">,</span>    <span class="token number">50</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 遍历所有的键（vegetables）</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> vegetable <span class="token keyword">of</span> recipeMap<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>vegetable<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cucumber, tomatoes, onion</span>
<span class="token punctuation">}</span>
<span class="token comment">// 遍历所有的值（amounts）</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> amount <span class="token keyword">of</span> recipeMap<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 500, 350, 50</span>
<span class="token punctuation">}</span>
<span class="token comment">// 遍历所有的实体 [key, value]</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> entry <span class="token keyword">of</span> recipeMap<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 与 recipeMap.entries() 相同</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cucumber,500 (and so on)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">使用插入顺序</p> <p>迭代的顺序与插入值的顺序相同。与普通的 <code>Object</code> 不同，<code>Map</code> 保留了此顺序</p></div> <h4 id="_5-7-3-object-entries-从对象创建-map"><a href="#_5-7-3-object-entries-从对象创建-map" class="header-anchor">#</a> 5.7.3 Object.entries：从对象创建 Map</h4> <p>当创建一个 <code>Map</code> 后，我们可以传入一个带有键值对的数组（或其它可迭代对象）来进行初始化，如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 键值对 [key, value] 数组</span>
<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span>  <span class="token string">'str1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>    <span class="token string">'num1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'bool1'</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// str1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果我们想从一个已有的普通对象（plain object）来创建一个 <code>Map</code>，那么我们可以使用内建方法 <a href="mdn:js/Object/entries">Object.entries(obj)</a>，该方法返回对象的键/值对数组，该数组格式完全按照 <code>Map</code> 所需的格式。</p> <p>所以可以像下面这样从一个对象创建一个 Map：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">/</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token function">alert</span><span class="token punctuation">(</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这里，<code>Object.entries</code> 返回键/值对数组：<code>[ [&quot;name&quot;,&quot;John&quot;], [&quot;age&quot;, 30] ]</code>。这就是 <code>Map</code> 所需要的格式</p> <h4 id="_5-7-4-object-fromentries-从-map-创建对象"><a href="#_5-7-4-object-fromentries-从-map-创建对象" class="header-anchor">#</a> 5.7.4 Object.fromEntries：从 Map 创建对象</h4> <p><code>Object.fromEntries</code> 方法的作用是相反的：给定一个具有 <code>[key, value]</code> 键值对的数组，它会根据给定数组创建一个对象：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> prices <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">'banana'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'orange'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'meat'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 现在 prices = { banana: 1, orange: 2, meat: 4 }</span>
<span class="token function">alert</span><span class="token punctuation">(</span>prices<span class="token punctuation">.</span>orange<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>我们可以使用 <code>Object.fromEntries</code> 从 <code>Map</code> 得到一个普通对象（plain object）。</p> <p>例如，我们在 <code>Map</code> 中存储了一些数据，但是我们需要把这些数据传给需要普通对象（plain object）的第三方代码。</p> <p>我们来开始：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'banana'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'meat'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个普通对象（plain object）(*)</span>
<span class="token operator">*</span><span class="token operator">/</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token comment">// 完成了！</span>
<span class="token comment">// obj = { banana: 1, orange: 2, meat: 4 }</span>
<span class="token function">alert</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>orange<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>调用 <code>map.entries()</code> 将返回一个可迭代的键/值对，这刚好是 <code>Object.fromEntries</code> 所需要的格式。</p> <p>我们可以把带 <code>(*)</code> 这一行写得更短：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 省掉 .entries()</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上面的代码作用也是一样的，因为 <code>Object.fromEntries</code> 期望得到一个可迭代对象作为参数，而不一定是数组。并且 <code>map</code> 的标准迭代会返回跟 <code>map.entries()</code> 一样的键/值对。因此，我们可以获得一个普通对象（plain object），其键/值对与 <code>map</code> 相同。</p> <h4 id="_5-7-5-set"><a href="#_5-7-5-set" class="header-anchor">#</a> 5.7.5 Set</h4> <p><code>Set</code> 是一个特殊的类型集合 —— “值的集合”（没有键），它的每一个值只能出现一次。</p> <p>它的主要方法如下：</p> <ul><li><code>new Set(iterable)</code> —— 创建一个 <code>set</code>，如果提供了一个 <code>iterable</code> 对象（通常是数组），将会从数组里面复制值到 <code>set</code> 中。</li> <li><code>set.add(value)</code> —— 添加一个值，返回 set 本身</li> <li><code>set.delete(value)</code> —— 删除值，如果 <code>value</code> 在这个方法调用的时候存在则返回 <code>true</code> ，否则返回 <code>false</code>。</li> <li><code>set.has(value)</code> —— 如果 <code>value</code> 在 set 中，返回 <code>true</code>，否则返回 <code>false</code>。</li> <li><code>set.clear()</code> —— 清空 set。</li> <li><code>set.size</code> —— 返回元素个数。</li></ul> <p>它的主要特点是，重复使用同一个值调用 <code>set.add(value)</code> 并不会发生什么改变。这就是 <code>Set</code> 里面的每一个值只出现一次的原因。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pete <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Pete&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> mary <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Mary&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// visits，一些访客来访好几次</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>john<span class="token punctuation">)</span><span class="token punctuation">;</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pete<span class="token punctuation">)</span><span class="token punctuation">;</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mary<span class="token punctuation">)</span><span class="token punctuation">;</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>john<span class="token punctuation">)</span><span class="token punctuation">;</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mary<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// set 只保留不重复的值</span>
<span class="token function">alert</span><span class="token punctuation">(</span> set<span class="token punctuation">.</span>size <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> user <span class="token keyword">of</span> set<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John（然后 Pete 和 Mary）</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><code>Set</code> 的替代方法可以是一个用户数组，用 <a href="mdn:js/Array/find">arr.find</a> 在每次插入值时检查是否重复。但是这样性能会很差，因为这个方法会遍历整个数组来检查每个元素。<code>Set</code> 内部对唯一性检查进行了更好的优化。</p> <h4 id="_5-7-6-set-迭代-iteration"><a href="#_5-7-6-set-迭代-iteration" class="header-anchor">#</a> 5.7.6 Set 迭代（iteration）</h4> <p>我们可以使用 <code>for..of</code> 或 <code>forEach</code> 来遍历 Set：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;oranges&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;apples&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bananas&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> value <span class="token keyword">of</span> set<span class="token punctuation">)</span> <span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 与 forEach 相同：</span>
set<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> valueAgain<span class="token punctuation">,</span> <span class="token keyword">set</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>注意一件有趣的事儿。<code>forEach</code> 的回调函数有三个参数：一个 <code>value</code>，然后是 <strong>同一个值</strong> <code>valueAgain</code>，最后是目标对象。没错，同一个值在参数里出现了两次。</p> <p><code>forEach</code> 的回调函数有三个参数，是为了与 <code>Map</code> 兼容。当然，这看起来确实有些奇怪。但是这对在特定情况下轻松地用 <code>Set</code> 代替 <code>Map</code> 很有帮助，反之亦然。</p> <p><code>Map</code> 中用于迭代的方法在 <code>Set</code> 中也同样支持：</p> <ul><li><code>set.keys()</code> —— 遍历并返回一个包含所有值的可迭代对象，</li> <li><code>set.values()</code> —— 与 <code>set.keys()</code> 作用相同，这是为了兼容 <code>Map</code>，</li> <li><code>set.entries()</code> —— 遍历并返回一个包含所有的实体 <code>[value, value]</code> 的可迭代对象，它的存在也是为了兼容 <code>Map</code>。</li></ul> <h3 id="_5-8-weakmap-and-weakset-弱映射和弱集合"><a href="#_5-8-weakmap-and-weakset-弱映射和弱集合" class="header-anchor">#</a> 5.8 WeakMap and WeakSet（弱映射和弱集合）</h3> <p>通常，当对象、数组之类的数据结构在内存中时，它们的子元素，如对象的属性、数组的元素都被认为是可达的<br>
如果我们使用对象作为常规 <code>Map</code> 的键，那么当 <code>Map</code> 存在时，该对象也将存在。它会占用内存，并且不会被（垃圾回收机制）回收。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>john<span class="token punctuation">,</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
john <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 覆盖引用</span>
<span class="token comment">// john 被存储在了 map 中，</span>
<span class="token comment">// 我们可以使用 map.keys() 来获取它</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>WeakMap</code> 在这方面有着根本上的不同。它不会阻止垃圾回收机制对作为键的对象（key object）的回收。</p> <h4 id="_5-8-1-weakmap"><a href="#_5-8-1-weakmap" class="header-anchor">#</a> 5.8.1 WeakMap</h4> <p><code>WeakMap</code> 和 <code>Map</code> 的第一个不同点就是，<code>WeakMap</code> 的键必须是对象，不能是原始值
如果我们在 weakMap 中使用一个对象作为键，并且没有其他对这个对象的引用 —— 该对象将会被从内存（和map）中自动清除。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> weakMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
weakMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>john<span class="token punctuation">,</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
john <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 覆盖引用</span>
<span class="token comment">// john 被从内存中删除了！</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>与上面常规的 <code>Map</code> 的例子相比，现在如果 <code>john</code> 仅仅是作为 <code>WeakMap</code> 的键而存在 —— 它将会被从 map（和内存）中自动删除。</p> <p><code>WeakMap</code> 不支持迭代以及 <code>keys()</code>，<code>values()</code> 和 <code>entries()</code> 方法。所以没有办法获取 <code>WeakMap</code> 的所有键或值。</p> <p><code>WeakMap</code> 只有以下的方法：</p> <ul><li><code>weakMap.get(key)</code></li> <li><code>weakMap.set(key, value)</code></li> <li><code>weakMap.delete(key)</code></li> <li><code>weakMap.has(key)</code></li></ul> <p>为什么会有这种限制呢？这是技术的原因。如果一个对象丢失了其它所有引用（就像上面示例中的 <code>john</code>），那么它就会被垃圾回收机制自动回收。但是在从技术的角度并不能准确知道 <strong>何时会被回收</strong>。</p> <p>这些都是由 JavaScript 引擎决定的。JavaScript 引擎可能会选择立即执行内存清理，如果现在正在发生很多删除操作，那么 JavaScript 引擎可能就会选择等一等，稍后再进行内存清理。因此，从技术上讲，<code>WeakMap</code> 的当前元素的数量是未知的。JavaScript 引擎可能清理了其中的垃圾，可能没清理，也可能清理了一部分。因此，暂不支持访问 <code>WeakMap</code> 的所有键/值的方法。</p> <h4 id="_5-8-2-weakmap使用案例"><a href="#_5-8-2-weakmap使用案例" class="header-anchor">#</a> 5.8.2 WeakMap使用案例</h4> <h5 id="额外的数据"><a href="#额外的数据" class="header-anchor">#</a> 额外的数据</h5> <p><code>WeakMap</code> 的主要应用场景是 <strong>额外数据的存储</strong>。</p> <p>假如我们正在处理一个“属于”另一个代码的一个对象，也可能是第三方库，并想存储一些与之相关的数据，那么这些数据就应该与这个对象共存亡 —— 这时候 <code>WeakMap</code> 正是我们所需要的利器。</p> <p>我们将这些数据放到 <code>WeakMap</code> 中，并使用该对象作为这些数据的键，那么当该对象被垃圾回收机制回收后，这些数据也会被自动清除。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>weakMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>john<span class="token punctuation">,</span> <span class="token string">&quot;secret documents&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果 john 消失，secret documents 将会被自动清除</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>例如，我们有用于处理用户访问计数的代码。收集到的信息被存储在 map 中：一个用户对象作为键，其访问次数为值。当一个用户离开时（该用户对象将被垃圾回收机制回收），这时我们就不再需要他的访问次数了。</p> <p>下面是一个使用 <code>Map</code> 的计数函数的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 📁 visitsCount.js</span>
<span class="token keyword">let</span> visitsCountMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// map: user =&gt; visits count</span>
<span class="token comment">// 递增用户来访次数</span>
<span class="token keyword">function</span> <span class="token function">countUser</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> count <span class="token operator">=</span> visitsCountMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
  visitsCountMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>下面是其他部分的代码，可能是使用它的其它代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 📁 main.js</span>
<span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">countUser</span><span class="token punctuation">(</span>john<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// count his visits</span>
<span class="token comment">// 不久之后，john 离开了</span>
john <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>现在，<code>john</code> 这个对象应该被垃圾回收，但它仍在内存中，因为它是 <code>visitsCountMap</code> 中的一个键。</p> <p>当我们移除用户时，我们需要清理 <code>visitsCountMap</code>，否则它将在内存中无限增大。在复杂的架构中，这种清理会成为一项繁重的任务。</p> <p>我们可以通过使用 <code>WeakMap</code> 来避免这样的问题：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 📁 visitsCount.js</span>
<span class="token keyword">let</span> visitsCountMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// weakmap: user =&gt; visits count</span>
<span class="token comment">// 递增用户来访次数</span>
<span class="token keyword">function</span> <span class="token function">countUser</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> count <span class="token operator">=</span> visitsCountMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
  visitsCountMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>现在我们不需要去清理 <code>visitsCountMap</code> 了。当 <code>john</code> 对象变成不可达时，即便它是 <code>WeakMap</code> 里的一个键，它也会连同它作为 <code>WeakMap</code> 里的键所对应的信息一同被从内存中删除。</p> <h5 id="缓存"><a href="#缓存" class="header-anchor">#</a> 缓存</h5> <p>另外一个常见的例子是缓存。我们可以存储（“缓存”）函数的结果，以便将来对同一个对象的调用可以重用这个结果。</p> <p>为了实现这一点，我们可以使用 <code>Map</code>（非最佳方案）：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 📁 cache.js</span>
<span class="token keyword">let</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算并记住结果</span>
<span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token comment">/* calculations of the result for */</span> obj<span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 现在我们在其它文件中使用 process()</span>
<span class="token comment">// 📁 main.js</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">/* 假设我们有个对象 */</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result1 <span class="token operator">=</span> <span class="token function">process</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 计算完成</span>
<span class="token comment">// ……稍后，来自代码的另外一个地方……</span>
<span class="token keyword">let</span> result2 <span class="token operator">=</span> <span class="token function">process</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取自缓存的被记忆的结果</span>
<span class="token comment">// ……稍后，我们不再需要这个对象时：</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1（啊！该对象依然在 cache 中，并占据着内存！）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>对于多次调用同一个对象，它只需在第一次调用时计算出结果，之后的调用可以直接从 <code>cache</code> 中获取。这样做的缺点是，当我们不再需要这个对象的时候需要清理 <code>cache</code>。</p> <p>如果我们用 <code>WeakMap</code> 替代 <code>Map</code>，便不会存在这个问题。当对象被垃圾回收时，对应缓存的结果也会被自动从内存中清除。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 📁 cache.js</span>
<span class="token keyword">let</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算并记结果</span>
<span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token comment">/* calculate the result for */</span> obj<span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 📁 main.js</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">/* some object */</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result1 <span class="token operator">=</span> <span class="token function">process</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result2 <span class="token operator">=</span> <span class="token function">process</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ……稍后，我们不再需要这个对象时：</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token comment">// 无法获取 cache.size，因为它是一个 WeakMap，</span>
<span class="token comment">// 要么是 0，或即将变为 0</span>
<span class="token comment">// 当 obj 被垃圾回收，缓存的数据也会被清除</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="_5-8-3-weakset"><a href="#_5-8-3-weakset" class="header-anchor">#</a> 5.8.3 WeakSet</h4> <p><code>WeakSet</code> 的表现类似：</p> <ul><li>与 <code>Set</code> 类似，但是我们只能向 <code>WeakSet</code> 添加对象（而不能是原始值）。</li> <li>对象只有在其它某个（些）地方能被访问的时候，才能留在 <code>WeakSet</code> 中。</li> <li>跟 <code>Set</code> 一样，<code>WeakSet</code> 支持 <code>add</code>，<code>has</code> 和 <code>delete</code> 方法，但不支持 <code>size</code> 和 <code>keys()</code>，并且不可迭代。</li></ul> <p>变“弱（weak）”的同时，它也可以作为额外的存储空间。但并非针对任意数据，而是针对“是/否”的事实。<code>WeakSet</code> 的元素可能代表着有关该对象的某些信息。</p> <p>例如，我们可以将用户添加到 <code>WeakSet</code> 中，以追踪访问过我们网站的用户：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> visitedSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> john <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pete <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Pete&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> mary <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Mary&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
visitedSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>john<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John 访问了我们</span>
visitedSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pete<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 然后是 Pete</span>
visitedSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>john<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John 再次访问</span>
<span class="token comment">// visitedSet 现在有两个用户了</span>
<span class="token comment">// 检查 John 是否来访过？</span>
<span class="token function">alert</span><span class="token punctuation">(</span>visitedSet<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>john<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token comment">// 检查 Mary 是否来访过？</span>
<span class="token function">alert</span><span class="token punctuation">(</span>visitedSet<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>mary<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
john <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token comment">// visitedSet 将被自动清理(即自动清除其中已失效的值 john)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><code>WeakMap</code> 和 <code>WeakSet</code> 最明显的局限性就是不能迭代，并且无法获取所有当前内容。那样可能会造成不便，但是并不会阻止 <code>WeakMap/WeakSet</code> 完成其主要工作 —— 为在其它地方存储/管理的对象数据提供“额外”存储。</p> <h3 id="_5-9-对象迭代"><a href="#_5-9-对象迭代" class="header-anchor">#</a> 5.9 对象迭代</h3> <p>在前面的章节中，我们认识了 <code>map.keys()</code>，<code>map.values()</code> 和 <code>map.entries()</code> 方法。</p> <p>这些方法是通用的，有一个共同的约定来将它们用于各种数据结构。如果我们创建一个我们自己的数据结构，我们也应该实现这些方法。</p> <p>它们支持：</p> <ul><li><code>Map</code></li> <li><code>Set</code></li> <li><code>Array</code></li></ul> <p>普通对象也支持类似的方法，但是语法上有一些不同</p> <h4 id="_5-9-1-object-keys-values-entries"><a href="#_5-9-1-object-keys-values-entries" class="header-anchor">#</a> 5.9.1  Object.keys，values，entries</h4> <p>对于普通对象，下列这些方法是可用的：</p> <ul><li><a href="mdn:js/Object/keys">Object.keys(obj)</a> —— 返回一个包含该对象所有的键的数组。</li> <li><a href="mdn:js/Object/values">Object.values(obj)</a> —— 返回一个包含该对象所有的值的数组。</li> <li><a href="mdn:js/Object/entries">Object.entries(obj)</a> —— 返回一个包含该对象所有 [key, value] 键值对的数组。</li></ul> <p>……但是请注意区别（比如说跟 map 的区别）：</p> <table><thead><tr><th></th> <th>Map</th> <th>Object</th></tr></thead> <tbody><tr><td>调用语法</td> <td><code>map.keys()</code></td> <td><code>Object.keys(obj)</code>，而不是 <code>obj.keys()</code></td></tr> <tr><td>返回值</td> <td>可迭代对象</td> <td>“真正的”数组</td></tr></tbody></table> <p>第一个区别是，对于对象我们使用的调用语法是 <code>Object.keys(obj)</code>，而不是 <code>obj.keys()</code>。</p> <p>为什么会这样？主要原因是灵活性。请记住，在 JavaScript 中，对象是所有复杂结构的基础。因此，我们可能有一个自己创建的对象，比如 <code>data</code>，并实现了它自己的 <code>data.values()</code> 方法。同时，我们依然可以对它调用 <code>Object.values(data)</code> 方法。</p> <p>第二个区别是 <code>Object.*</code> 方法返回的是“真正的”数组对象，而不只是一个可迭代对象。这主要是历史原因。</p> <p>举个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>Object.keys(user) = [&quot;name&quot;, &quot;age&quot;]</code></li> <li><code>Object.values(user) = [&quot;John&quot;, 30]</code></li> <li><code>Object.entries(user) = [ [&quot;name&quot;,&quot;John&quot;], [&quot;age&quot;,30] ]</code></li></ul> <p>这里有一个使用 <code>Object.values</code> 来遍历属性值的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 遍历所有的值</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> value <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John, then 30</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">Object.keys/values/entries 会忽略 symbol 属性</p> <p>就像 <code>for..in</code> 循环一样，这些方法会忽略使用 <code>Symbol(...)</code> 作为键的属性。
通常这很方便。但是，如果我们也想要 Symbol 类型的键，那么这儿有一个单独的方法 <a href="mdn:js/Object/getOwnPropertySymbols">Object.getOwnPropertySymbols</a>，它会返回一个只包含 Symbol 类型的键的数组。另外，还有一种方法 <a href="mdn:js/Reflect/ownKeys">Reflect.ownKeys(obj)</a>，它会返回 <strong>所有</strong> 键。</p></div> <h4 id="_5-9-2-转换对象"><a href="#_5-9-2-转换对象" class="header-anchor">#</a> 5.9.2 转换对象</h4> <p>对象缺少数组存在的许多方法，例如 <code>map</code> 和 <code>filter</code> 等。</p> <p>如果我们想应用它们，那么我们可以使用 <code>Object.entries</code>，然后使用 <code>Object.fromEntries</code>：</p> <ol><li>使用 <code>Object.entries(obj)</code> 从 <code>obj</code> 获取由键/值对组成的数组。</li> <li>对该数组使用数组方法，例如 <code>map</code>，对这些键/值对进行转换。</li> <li>对结果数组使用 <code>Object.fromEntries(array)</code> 方法，将结果转回成对象。</li></ol> <p>例如，我们有一个带有价格的对象，并想将它们加倍：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> prices <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">banana</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">orange</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token literal-property property">meat</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> doublePrices <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>
  <span class="token comment">// 将价格转换为数组，将每个键/值对映射为另一对</span>
  <span class="token comment">// 然后通过 fromEntries 再将结果转换为对象</span>
  Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>prices<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>entry<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> entry<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>doublePrices<span class="token punctuation">.</span>meat<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_5-10-解构赋值"><a href="#_5-10-解构赋值" class="header-anchor">#</a> 5.10 解构赋值</h3> <p>JavaScript 中最常用的两种数据结构是 <code>Object</code> 和 <code>Array</code>。</p> <ul><li>对象是一种根据键存储数据的实体。</li> <li>数组是一种直接存储数据的有序列表。</li></ul> <p>但是，当我们把它们传递给函数时，函数可能不需要整个对象/数组，而只需要其中一部分。</p> <p><strong>解构赋值</strong> 是一种特殊的语法，它使我们可以将数组或对象“拆包”至一系列变量中。有时这样做更方便</p> <h4 id="_5-10-1-数组解构"><a href="#_5-10-1-数组解构" class="header-anchor">#</a> 5.10.1 数组解构</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 我们有一个存放了名字和姓氏的数组</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Smith&quot;</span><span class="token punctuation">]</span>
<span class="token operator">*</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token comment">// 解构赋值</span>
<span class="token comment">// 设置 firstName = arr[0]</span>
<span class="token comment">// 以及 surname = arr[1]</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> surname<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">/</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token function">alert</span><span class="token punctuation">(</span>firstName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John</span>
<span class="token function">alert</span><span class="token punctuation">(</span>surname<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Smith</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>我们可以使用这些变量而非原来的数组项了。</p> <p>当与 <code>split</code> 函数（或其他返回值为数组的函数）结合使用时，看起来更优雅：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> surname<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;John Smith&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>firstName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John</span>
<span class="token function">alert</span><span class="token punctuation">(</span>surname<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Smith</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">“解构”并不意味着“破坏”</p> <p>这种语法被叫做“解构赋值”，是因为它“拆开”了数组或对象，将其中的各元素复制给一些变量。原来的数组或对象自身没有被修改。<br>
换句话说，解构赋值只是写起来简洁一点。以下两种写法是等价的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// let [firstName, surname] = arr;</span>
<span class="token keyword">let</span> firstName <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> surname <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <div class="custom-block tip"><p class="custom-block-title">忽略使用逗号的元素</p> <p>可以通过添加额外的逗号来丢弃数组中不想要的元素：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 不需要第二个元素</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> <span class="token punctuation">,</span> title<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Julius&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Caesar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Consul&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;of the Roman Republic&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> title <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Consul</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在上面的代码中，数组的第二个元素被跳过了，第三个元素被赋值给了 <code>title</code> 变量。数组中剩下的元素也都被跳过了（因为在这没有对应给它们的变量）</p></div> <div class="custom-block tip"><p class="custom-block-title">等号右侧可以是任何可迭代对</p> <p>实际上，我们可以将其与任何可迭代对象一起使用，而不仅限于数组：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>one<span class="token punctuation">,</span> two<span class="token punctuation">,</span> three<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这种情况下解构赋值是通过迭代右侧的值来完成工作的。这是一种用于对在 <code>=</code> 右侧的值上调用 <code>for..of</code> 并进行赋值的操作的语法糖</p></div> <div class="custom-block tip"><p class="custom-block-title">赋值给等号左侧的任何内容</p> <p>我们可以在等号左侧使用任何“可以被赋值的”东西。
例如，一个对象的属性：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user<span class="token punctuation">.</span>surname<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;John Smith&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// John</span>
<span class="token function">alert</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>surname<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Smith</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <div class="custom-block tip"><p class="custom-block-title">与 .entries() 方法进行循环操作</p> <p>在前面的章节中我们已经见过了 <a href="mdn:js/Object/entries">Object.entries(obj)</a> 方法。
我们可以将 .entries() 方法与解构语法一同使用，来遍历一个对象的“键—值”对：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 使用循环遍历键—值对</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name:John, then age:30</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>用于 <code>Map</code> 的类似代码更简单，因为 Map 是可迭代的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;30&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Map 是以 [key, value] 对的形式进行迭代的，非常便于解构</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name:John, then age:30</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div> <div class="custom-block tip"><p class="custom-block-title">交换变量值的技巧</p> <p>使用解构赋值来交换两个变量的值是一个著名的技巧：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> guest <span class="token operator">=</span> <span class="token string">&quot;Jane&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> admin <span class="token operator">=</span> <span class="token string">&quot;Pete&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 让我们来交换变量的值：使得 guest = Pete，admin = Jane</span>
<span class="token punctuation">[</span>guest<span class="token punctuation">,</span> admin<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>admin<span class="token punctuation">,</span> guest<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>guest<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>admin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Pete Jane（成功交换！）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这里我们创建了一个由两个变量组成的临时数组，并且立即以颠倒的顺序对其进行了解构赋值。<br>
我们也可以用这种方式交换两个以上的变量</p></div> <h5 id="其余的"><a href="#其余的" class="header-anchor">#</a> 其余的 '...'</h5> <p>通常，如果数组比左边的列表长，那么“其余”的数组项会被省略。</p> <p>例如，这里只取了两项，其余的就被忽略了：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">[</span>name1<span class="token punctuation">,</span> name2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Julius&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Caesar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Consul&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;of the Roman Republic&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>name1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Julius</span>
<span class="token function">alert</span><span class="token punctuation">(</span>name2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Caesar</span>
<span class="token comment">// 其余数组项未被分配到任何地方</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果我们还想收集其余的数组项 —— 我们可以使用三个点 <code>&quot;...&quot;</code> 来再加一个参数以获取其余数组项：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">[</span>name1<span class="token punctuation">,</span> name2<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Julius&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Caesar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Consul&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;of the Roman Republic&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// rest 是包含从第三项开始的其余数组项的数组</span>
<span class="token function">alert</span><span class="token punctuation">(</span>rest<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Consul</span>
<span class="token function">alert</span><span class="token punctuation">(</span>rest<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// of the Roman Republic</span>
<span class="token function">alert</span><span class="token punctuation">(</span>rest<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>rest</code> 的值就是数组中剩下的元素组成的数组。</p> <p>不一定要使用变量名 <code>rest</code>，我们也可以使用任何其他的变量名。只要确保它前面有三个点，并且在解构赋值的最后一个参数位置上就行了：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">[</span>name1<span class="token punctuation">,</span> name2<span class="token punctuation">,</span> <span class="token operator">...</span>titles<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Julius&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Caesar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Consul&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;of the Roman Republic&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 现在 titles = [&quot;Consul&quot;, &quot;of the Roman Republic&quot;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="默认值"><a href="#默认值" class="header-anchor">#</a> 默认值</h5> <p>如果数组比左边的变量列表短，这里不会出现报错。缺少对应值的变量都会被赋 <code>undefined</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> surname<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>firstName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
<span class="token function">alert</span><span class="token punctuation">(</span>surname<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果我们想要一个“默认”值给未赋值的变量，我们可以使用 <code>=</code> 来提供：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 默认值</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>name <span class="token operator">=</span> <span class="token string">&quot;Guest&quot;</span><span class="token punctuation">,</span> surname <span class="token operator">=</span> <span class="token string">&quot;Anonymous&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Julius&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Julius（来自数组的值）</span>
<span class="token function">alert</span><span class="token punctuation">(</span>surname<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Anonymous（默认值被使用了）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>默认值可以是更加复杂的表达式，甚至可以是函数调用。不过，这些表达式或函数只会在这个变量未被赋值的时候才会被计算。</p> <p>举个例子，我们使用了 <code>prompt</code> 函数来提供两个默认值：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 只会提示输入姓氏</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>name <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">'name?'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> surname <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">'surname?'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Julius&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Julius（来自数组）</span>
<span class="token function">alert</span><span class="token punctuation">(</span>surname<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 你输入的值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>请注意：<code>prompt</code> 将仅针对缺失值（<code>surname</code>）运行</p> <h4 id="_5-10-2-对象解构"><a href="#_5-10-2-对象解构" class="header-anchor">#</a> 5.10.2 对象解构</h4> <p>解构赋值同样适用于对象。基本语法是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">{</span>var1<span class="token punctuation">,</span> var2<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">var1</span><span class="token operator">:</span>…<span class="token punctuation">,</span> <span class="token literal-property property">var2</span><span class="token operator">:</span>…<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在等号右侧是一个已经存在的对象，我们想把它拆分到变量中。等号左侧包含了对象相应属性的一个类对象“模式（pattern）”。在最简单的情况下，等号左侧的就是 <code>{...}</code> 中的变量名列表。</p> <p>如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Menu&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">200</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>title<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">/</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token function">alert</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Menu</span>
<span class="token function">alert</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 100</span>
<span class="token function">alert</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 200</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>属性 <code>options.title</code>、<code>options.width</code> 和 <code>options.height</code> 值被赋给了对应的变量。</p> <p>变量的顺序并不重要，下面这个代码也是等价的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 改变 let {...} 中元素的顺序</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>height<span class="token punctuation">,</span> width<span class="token punctuation">,</span> title<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Menu&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>等号左侧的模式（pattern）可以更加复杂，指定属性和变量之间的映射关系。</p> <p>如果我们想把一个属性赋值给另一个名字的变量，比如把 <code>options.width</code> 属性赋值给名为 <code>w</code> 的变量，那么我们可以使用冒号来设置变量名称：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Menu&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">200</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// { sourceProperty: targetVariable }</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span> w<span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> h<span class="token punctuation">,</span> title<span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
<span class="token comment">// width -&gt; w</span>
<span class="token comment">// height -&gt; h</span>
<span class="token comment">// title -&gt; title</span>
<span class="token function">alert</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Menu</span>
<span class="token function">alert</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 100</span>
<span class="token function">alert</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 200</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>冒号的语法是“从对象中什么属性的值：赋值给哪个变量”。上面的例子中，属性 <code>width</code> 被赋值给了 <code>w</code>，属性 <code>height</code> 被赋值给了 <code>h</code>，属性 <code>title</code> 被赋值给了同名变量。</p> <p>对于可能缺失的属性，我们可以使用 <code>&quot;=&quot;</code> 设置默认值，如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Menu&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>width <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span> title<span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">/</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token function">alert</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Menu</span>
<span class="token function">alert</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 100</span>
<span class="token function">alert</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 200</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>就像数组或函数参数一样，默认值可以是任意表达式甚至可以是函数调用。它们只会在未提供对应的值时才会被计算/调用。</p> <p>在下面的代码中，<code>prompt</code> 提示输入 <code>width</code> 值，但不会提示输入 <code>title</code> 值：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Menu&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>width <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">&quot;width?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">&quot;title?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">/</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token function">alert</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Menu</span>
<span class="token function">alert</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// (prompt 的返回值)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>我们还可以将冒号和等号结合起来：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Menu&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span> w <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> h <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span> title<span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">/</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token function">alert</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Menu</span>
<span class="token function">alert</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 100</span>
<span class="token function">alert</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 200</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如果我们有一个具有很多属性的复杂对象，那么我们可以只提取所需的内容：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Menu&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">200</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 仅提取 title 作为变量</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> title <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Menu</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="剩余模式-pattern"><a href="#剩余模式-pattern" class="header-anchor">#</a> 剩余模式（pattern）&quot;...&quot;</h5> <p>如果对象拥有的属性数量比我们提供的变量数量还多，该怎么办？我们可以只取其中的某一些属性，然后把“剩余的”赋值到其他地方吗？</p> <p>我们可以使用剩余模式（pattern），与数组类似。一些较旧的浏览器不支持此功能（例如 IE，可以使用 Babel 对其进行 polyfill），但可以在现代浏览器中使用。</p> <p>看起来就像这样：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Menu&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// title = 名为 title 的属性</span>
<span class="token comment">// rest = 存有剩余属性的对象</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>title<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
<span class="token comment">// 现在 title=&quot;Menu&quot;, rest={height: 200, width: 100}</span>
<span class="token function">alert</span><span class="token punctuation">(</span>rest<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 200</span>
<span class="token function">alert</span><span class="token punctuation">(</span>rest<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 100</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">不使用 `let` 时的陷阱</p> <p>在上面的示例中，变量都是在赋值中通过正确方式声明的：<code>let {…} = {…}</code>。当然，我们也可以使用已有的变量，而不用 <code>let</code>，但这里有一个陷阱。
以下代码无法正常运行：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> title<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">;</span>
<span class="token comment">// 这一行发生了错误</span>
<span class="token punctuation">{</span>title<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Menu&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>问题在于 JavaScript 把主代码流（即不在其他表达式中）的 <code>{...}</code> 当做一个代码块。这样的代码块可以用于对语句分组，如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token comment">// 一个代码块</span>
  <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> message <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>因此，这里 JavaScript 假定我们有一个代码块，这就是报错的原因。我们需要解构它。
为了告诉 JavaScript 这不是一个代码块，我们可以把整个赋值表达式用括号 <code>(...)</code> 包起来：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> title<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">;</span>
<span class="token comment">// 现在就可以了</span>
<span class="token punctuation">(</span><span class="token punctuation">{</span>title<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Menu&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> title <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Menu</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <h4 id="_5-10-3-嵌套解构"><a href="#_5-10-3-嵌套解构" class="header-anchor">#</a> 5.10.3 嵌套解构</h4> <p>如果一个对象或数组嵌套了其他的对象和数组，我们可以在等号左侧使用更复杂的模式（pattern）来提取更深层的数据。</p> <p>在下面的代码中，<code>options</code> 的属性 <code>size</code> 是另一个对象，属性 <code>items</code> 是另一个数组。赋值语句中等号左侧的模式（pattern）具有相同的结构以从中提取值：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">200</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Cake&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Donut&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">extra</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 为了清晰起见，解构赋值语句被写成多行的形式</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 把 size 赋值到这里</span>
    width<span class="token punctuation">,</span>
    height
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span>item1<span class="token punctuation">,</span> item2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 把 items 赋值到这里</span>
  title <span class="token operator">=</span> <span class="token string">&quot;Menu&quot;</span> <span class="token comment">// 在对象中不存在（使用默认值）</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Menu</span>
<span class="token function">alert</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 100</span>
<span class="token function">alert</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 200</span>
<span class="token function">alert</span><span class="token punctuation">(</span>item1<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Cake</span>
<span class="token function">alert</span><span class="token punctuation">(</span>item2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Donut</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>对象 <code>options</code> 的所有属性，除了 <code>extra</code> 属性在等号左侧不存在，都被赋值给了对应的变量：</p> <p><img src="https://pic.imgdb.cn/item/630c82db16f2c2beb12c62b9.jpg" alt="赋值过程"></p> <p>最终，我们得到了 <code>width</code>、<code>height</code>、<code>item1</code>、<code>item2</code> 和具有默认值的 <code>title</code> 变量。</p> <p>注意，<code>size</code> 和 <code>items</code> 没有对应的变量，因为我们取的是它们的内容。</p> <h4 id="_5-10-4-智能函数参数"><a href="#_5-10-4-智能函数参数" class="header-anchor">#</a> 5.10.4 智能函数参数</h4> <p>有时，一个函数有很多参数，其中大部分的参数都是可选的。对用户界面来说更是如此。想象一个创建菜单的函数。它可能具有宽度参数，高度参数，标题参数和项目列表等。</p> <p>下面是实现这种函数的一个很不好的写法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">showMenu</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;Untitled&quot;</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在实际开发中，记忆如此多的参数的位置是一个很大的负担。通常集成开发环境（IDE）会尽力帮助我们，特别是当代码有良好的文档注释的时候，但是…… 另一个问题就是，在大部分的参数只需采用默认值的情况下，调用这个函数时会需要写大量的 undefined。</p> <p>像这样：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 在采用默认值就可以的位置设置 undefined</span>
<span class="token function">showMenu</span><span class="token punctuation">(</span><span class="token string">&quot;My Menu&quot;</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;Item1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Item2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这太难看了。而且，当我们处理更多参数的时候可读性会变得很差。</p> <p>解构赋值可以解决这些问题。</p> <p>我们可以用一个对象来传递所有参数，而函数负责把这个对象解构成各个参数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 我们传递一个对象给函数</span>
<span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;My menu&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Item1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Item2&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// ……然后函数马上把对象解构成变量</span>
<span class="token keyword">function</span> <span class="token function">showMenu</span><span class="token punctuation">(</span><span class="token punctuation">{</span>title <span class="token operator">=</span> <span class="token string">&quot;Untitled&quot;</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// title, items – 提取于 options，</span>
  <span class="token comment">// width, height – 使用默认值</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// My Menu 200 100</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> items <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Item1, Item2</span>
<span class="token punctuation">}</span>
<span class="token function">showMenu</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>我们也可以使用带有嵌套对象和冒号映射的更加复杂的解构：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;My menu&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Item1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Item2&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">showMenu</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  title <span class="token operator">=</span> <span class="token string">&quot;Untitled&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> w <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>  <span class="token comment">// width goes to w</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> h <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token comment">// height goes to h</span>
  <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span>item1<span class="token punctuation">,</span> item2<span class="token punctuation">]</span> <span class="token comment">// items first element goes to item1, second to item2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>w<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>h<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// My Menu 100 200</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> item1 <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Item1</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> item2 <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Item2</span>
<span class="token punctuation">}</span>
<span class="token function">showMenu</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>完整语法和解构赋值是一样的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>
  <span class="token literal-property property">incomingProperty</span><span class="token operator">:</span> varName <span class="token operator">=</span> defaultValue
  <span class="token operator">...</span>
<span class="token punctuation">}</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>对于参数对象，属性 <code>incomingProperty</code> 对应的变量是 <code>varName</code>，默认值是 <code>defaultValue</code>。
请注意，这种解构假定了 <code>showMenu()</code> 函数确实存在参数。如果我们想让所有的参数都使用默认值，那我们应该传递一个空对象：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">showMenu</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不错，所有值都取默认值</span>
<span class="token function">showMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这样会导致错误</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>我们可以通过指定空对象 <code>{}</code> 为整个参数对象的默认值来解决这个问题：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">showMenu</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title <span class="token operator">=</span> <span class="token string">&quot;Menu&quot;</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token operator">*</span><span class="token operator">!</span><span class="token operator">*</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">*</span><span class="token operator">/</span><span class="token operator">!</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">showMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Menu 100 200</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在上面的代码中，整个参数对象的默认是 <code>{}</code>，因此总会有内容可以用来解构</p> <h3 id="_5-11-日期和时间"><a href="#_5-11-日期和时间" class="header-anchor">#</a> 5.11 日期和时间</h3> <p><a href="mdn:js/Date">日期（Date）</a>存储日期和时间，并提供了日期/时间的管理方法。</p> <p>我们可以使用它来存储创建/修改时间，测量时间，或者仅用来打印当前时间</p> <h4 id="_5-11-1-创建"><a href="#_5-11-1-创建" class="header-anchor">#</a> 5.11.1 创建</h4> <p>调用 <code>new Date()</code> 来创建一个新的 <code>Date</code> 对象。在调用时可以带有一些参数，如下所示：</p> <p><code>new Date()</code>
: 不带参数 —— 创建一个表示当前日期和时间的 <code>Date</code> 对象：</p> <div class="language- extra-class"><pre><code>```js
let now = new Date();
alert( now ); // 显示当前的日期/时间
```
</code></pre></div><p><code>new Date(milliseconds)</code>
: 创建一个 <code>Date</code> 对象，其时间等于 1970 年 1 月 1 日 UTC+0 之后经过的毫秒数（1/1000 秒）。</p> <div class="language- extra-class"><pre><code>```js
// 0 表示 01.01.1970 UTC+0
let Jan01_1970 = new Date(0);
alert( Jan01_1970 );
// 现在增加 24 小时，得到 02.01.1970 UTC+0
let Jan02_1970 = new Date(24 * 3600 * 1000);
alert( Jan02_1970 );
```

传入的整数参数代表的是自 1970-01-01 00:00:00 以来经过的毫秒数，该整数被称为 **时间戳**。

这是一种日期的轻量级数字表示形式。我们通常使用 `new Date(timestamp)` 通过时间戳来创建日期，并可以使用 `date.getTime()` 将现有的 `Date` 对象转化为时间戳（下文会讲到）。

在 01.01.1970 之前的日期带有负的时间戳，例如：
```js
// 31 Dec 1969
let Dec31_1969 = new Date(-24 * 3600 * 1000);
alert( Dec31_1969 );
```
</code></pre></div><p><code>new Date(datestring)</code>
: 如果只有一个参数，并且是字符串，那么它会被自动解析。该算法与 <code>Date.parse</code> 所使用的算法相同，将在下文中进行介绍。</p> <div class="language- extra-class"><pre><code>```js
let date = new Date(&quot;2017-01-26&quot;);
alert(date);
// 未指定具体时间，所以假定时间为格林尼治标准时间（GMT）的午夜零点
// 并根据运行代码时的用户的时区进行调整
// 因此，结果可能是
// Thu Jan 26 2017 11:00:00 GMT+1100 (Australian Eastern Daylight Time)
// 或
// Wed Jan 25 2017 16:00:00 GMT-0800 (Pacific Standard Time)
```
</code></pre></div><p><code>new Date(year, month, date, hours, minutes, seconds, ms)</code>
: 使用当前时区中的给定组件创建日期。只有前两个参数是必须的。</p> <div class="language- extra-class"><pre><code>- `year` 应该是四位数。为了兼容性，也接受 2 位数，并将其视为 `19xx`，例如 `98` 与 `1998` 相同，但强烈建议始终使用 4 位数。
- `month` 计数从 `0`（一月）开始，到 `11`（十二月）结束。
- `date` 是当月的具体某一天，如果缺失，则为默认值 `1`。
- 如果 `hours/minutes/seconds/ms` 缺失，则均为默认值 `0`。

例如：

```js
new Date(2011, 0, 1, 0, 0, 0, 0); // 1 Jan 2011, 00:00:00
new Date(2011, 0, 1); // 同样，时分秒等均为默认值 0
```

时间度量最大精确到 1 毫秒（1/1000 秒）：

```js
let date = new Date(2011, 0, 1, 2, 3, 4, 567);
alert( date ); // 1.01.2011, 02:03:04.567
```
</code></pre></div><h4 id="_5-11-2-访问日期组件"><a href="#_5-11-2-访问日期组件" class="header-anchor">#</a> 5.11.2 访问日期组件</h4> <p>从 <code>Date</code> 对象中访问年、月等信息有多种方式：</p> <p><a href="mdn:js/Date/getFullYear">getFullYear()</a>
: 获取年份（4 位数）</p> <p><a href="mdn:js/Date/getMonth">getMonth()</a>
: 获取月份，<strong>从 0 到 11</strong>。</p> <p><a href="mdn:js/Date/getDate">getDate()</a>
: 获取当月的具体日期，从 1 到 31，这个方法名称可能看起来有些令人疑惑。</p> <p><a href="mdn:js/Date/getHours">getHours()</a>，<a href="mdn:js/Date/getMinutes">getMinutes()</a>，<a href="mdn:js/Date/getSeconds">getSeconds()</a>，<a href="mdn:js/Date/getMilliseconds">getMilliseconds()</a>
: 获取相应的时间组件。</p> <div class="custom-block warning"><p class="custom-block-title">不是 `getYear()`，而是 `getFullYear()`</p> <p>很多 JavaScript 引擎都实现了一个非标准化的方法 <code>getYear()</code>。不推荐使用这个方法。它有时候可能会返回 2 位的年份信息。永远不要使用它。要获取年份就使用 <code>getFullYear()</code>。</p></div> <p>另外，我们还可以获取一周中的第几天：</p> <p><a href="mdn:js/Date/getDay">getDay()</a>
: 获取一周中的第几天，从 <code>0</code>（星期日）到 <code>6</code>（星期六）。第一天始终是星期日，在某些国家可能不是这样的习惯，但是这不能被改变。</p> <p><strong>以上的所有方法返回的组件都是基于当地时区的。</strong></p> <p>当然，也有与当地时区的 UTC 对应项，它们会返回基于 UTC+0 时区的日、月、年等：<a href="mdn:js/Date/getUTCFullYear">getUTCFullYear()</a>，<a href="mdn:js/Date/getUTCMonth">getUTCMonth()</a>，<a href="mdn:js/Date/getUTCDay">getUTCDay()</a>。只需要在 <code>&quot;get&quot;</code> 之后插入 <code>&quot;UTC&quot;</code> 即可。</p> <p>如果你当地时区相对于 UTC 有偏移，那么下面代码会显示不同的小时数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//  当前日期</span>
<span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 当地时区的小时数</span>
<span class="token function">alert</span><span class="token punctuation">(</span> date<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 在 UTC+0 时区的小时数（非夏令时的伦敦时间）</span>
<span class="token function">alert</span><span class="token punctuation">(</span> date<span class="token punctuation">.</span><span class="token function">getUTCHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>除了上述给定的方法，还有两个没有 UTC 变体的特殊方法：</p> <p><a href="mdn:js/Date/getTime">getTime()</a>
: 返回日期的时间戳 —— 从 1970-1-1 00:00:00 UTC+0 开始到现在所经过的毫秒数。</p> <p><a href="mdn:js/Date/getTimezoneOffset">getTimezoneOffset()</a>
: 返回 UTC 与本地时区之间的时差，以分钟为单位：</p> <div class="language- extra-class"><pre><code>```js
// 如果你在时区 UTC-1，输出 60
// 如果你在时区 UTC+3，输出 -180
alert( new Date().getTimezoneOffset() );
```
</code></pre></div><h4 id="_5-11-3-设置日期组件"><a href="#_5-11-3-设置日期组件" class="header-anchor">#</a> 5.11.3 设置日期组件</h4> <p>下列方法可以设置日期/时间组件：</p> <ul><li><a href="mdn:js/Date/setFullYear"><code>setFullYear(year, [month], [date])</code></a></li> <li><a href="mdn:js/Date/setMonth"><code>setMonth(month, [date])</code></a></li> <li><a href="mdn:js/Date/setDate"><code>setDate(date)</code></a></li> <li><a href="mdn:js/Date/setHours"><code>setHours(hour, [min], [sec], [ms])</code></a></li> <li><a href="mdn:js/Date/setMinutes"><code>setMinutes(min, [sec], [ms])</code></a></li> <li><a href="mdn:js/Date/setSeconds"><code>setSeconds(sec, [ms])</code></a></li> <li><a href="mdn:js/Date/setMilliseconds"><code>setMilliseconds(ms)</code></a></li> <li><a href="mdn:js/Date/setTime"><code>setTime(milliseconds)</code></a>（使用自 1970-01-01 00:00:00 UTC+0 以来的毫秒数来设置整个日期）</li></ul> <p>以上方法除了 <code>setTime()</code> 都有 UTC 变体，例如：<code>setUTCHours()</code>。</p> <p>我们可以看到，有些方法可以一次性设置多个组件，比如 <code>setHours</code>。未提及的组件不会被修改。</p> <p>举个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> today <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
today<span class="token punctuation">.</span><span class="token function">setHours</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>today<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 日期依然是今天，但是小时数被改为了 0</span>
today<span class="token punctuation">.</span><span class="token function">setHours</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>today<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 日期依然是今天，时间为 00:00:00。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_5-11-4-自动校准-autocorrection"><a href="#_5-11-4-自动校准-autocorrection" class="header-anchor">#</a> 5.11.4 自动校准（Autocorrection）</h4> <p><strong>自动校准</strong> 是 <code>Date</code> 对象的一个非常方便的特性。我们可以设置超范围的数值，它会自动校准。</p> <p>举个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2013</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">!</span><span class="token operator">*</span><span class="token number">32</span><span class="token operator">*</span><span class="token operator">/</span><span class="token operator">!</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 32 Jan 2013 ?!?</span>
<span class="token function">alert</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ……是 1st Feb 2013!</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>超出范围的日期组件将会被自动分配。</p> <p>假设我们要在日期 &quot;28 Feb 2016&quot; 上加 2 天。结果可能是 &quot;2 Mar&quot; 或 &quot;1 Mar&quot;，因为存在闰年。但是我们不需要考虑这些，只需要直接加 2 天，剩下的 <code>Date</code> 对象会帮我们处理：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2016</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">!</span><span class="token operator">*</span>
date<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">/</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token function">alert</span><span class="token punctuation">(</span> date <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 Mar 2016</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这个特性经常被用来获取给定时间段后的日期。例如，我们想获取“现在 70 秒后”的日期：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
date<span class="token punctuation">.</span><span class="token function">setSeconds</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> date <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显示正确的日期信息</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>我们还可以设置 0 甚至可以设置负值。例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2016</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2016 年 1 月 2 日</span>
date<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置为当月的第一天</span>
<span class="token function">alert</span><span class="token punctuation">(</span> date <span class="token punctuation">)</span><span class="token punctuation">;</span>
date<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 天数最小可以设置为 1，所以这里设置的是上一月的最后一天</span>
<span class="token function">alert</span><span class="token punctuation">(</span> date <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 31 Dec 2015</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_5-11-5-日期转化为数字-日期差值"><a href="#_5-11-5-日期转化为数字-日期差值" class="header-anchor">#</a> 5.11.5 日期转化为数字，日期差值</h4> <p>当 <code>Date</code> 对象被转化为数字时，得到的是对应的时间戳，与使用 <code>date.getTime()</code> 的结果相同：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token operator">+</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 以毫秒为单位的数值，与使用 date.getTime() 的结果相同</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>有一个重要的副作用：日期可以相减，相减的结果是以毫秒为单位时间差。</p> <p>这个作用可以用于时间测量：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 开始测量时间</span>
<span class="token comment">// do the job</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> doSomething <span class="token operator">=</span> i <span class="token operator">*</span> i <span class="token operator">*</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> end <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 结束测量时间</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The loop took </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>end <span class="token operator">-</span> start<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ms</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_5-11-6-date-now"><a href="#_5-11-6-date-now" class="header-anchor">#</a> 5.11.6 Date.now()</h4> <p>如果我们仅仅想要测量时间间隔，我们不需要 <code>Date</code> 对象。</p> <p>有一个特殊的方法 <code>Date.now()</code>，它会返回当前的时间戳。</p> <p>它相当于 <code>new Date().getTime()</code>，但它不会创建中间的 <code>Date</code> 对象。因此它更快，而且不会对垃圾回收造成额外的压力。</p> <p>这种方法很多时候因为方便，又或是因性能方面的考虑而被采用，例如使用 JavaScript 编写游戏或其他的特殊应用场景。</p> <p>因此这样做可能会更好：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从 1 Jan 1970 至今的时间戳</span>
<span class="token comment">// do the job</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> doSomething <span class="token operator">=</span> i <span class="token operator">*</span> i <span class="token operator">*</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> end <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 完成</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The loop took </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>end <span class="token operator">-</span> start<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ms</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 相减的是时间戳，而不是日期</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_5-11-7-基准测试-benchmarking"><a href="#_5-11-7-基准测试-benchmarking" class="header-anchor">#</a> 5.11.7 基准测试（Benchmarking）</h4> <p>在对一个很耗 CPU 性能的函数进行可靠的基准测试（Benchmarking）时，我们需要谨慎一点。</p> <p>例如，我们想判断以下两个计算日期差值的函数：哪个更快？</p> <p>这种性能测量通常称为“基准测试（benchmark）”。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 我们有 date1 和 date2，哪个函数会更快地返回两者的时间差？</span>
<span class="token keyword">function</span> <span class="token function">diffSubtract</span><span class="token punctuation">(</span><span class="token parameter">date1<span class="token punctuation">,</span> date2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> date2 <span class="token operator">-</span> date1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// or</span>
<span class="token keyword">function</span> <span class="token function">diffGetTime</span><span class="token punctuation">(</span><span class="token parameter">date1<span class="token punctuation">,</span> date2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> date2<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> date1<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这两个函数做的事情完全相同，但是其中一个函数使用显式的 <code>date.getTime()</code> 来获取毫秒形式的日期，另一个则依赖于“日期 — 数字”的转换。它们的结果是一样的。</p> <p>那么，哪个更快呢？</p> <p>首先想到的方法可能是连续运行两者很多次，并计算所消耗的时间之差。就这个例子而言，函数过于简单，所以我们必须执行至少 100000 次。</p> <p>让我们开始测量：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">diffSubtract</span><span class="token punctuation">(</span><span class="token parameter">date1<span class="token punctuation">,</span> date2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> date2 <span class="token operator">-</span> date1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">diffGetTime</span><span class="token punctuation">(</span><span class="token parameter">date1<span class="token punctuation">,</span> date2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> date2<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> date1<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">bench</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> date1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> date2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">f</span><span class="token punctuation">(</span>date1<span class="token punctuation">,</span> date2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'Time of diffSubtract: '</span> <span class="token operator">+</span> <span class="token function">bench</span><span class="token punctuation">(</span>diffSubtract<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'ms'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'Time of diffGetTime: '</span> <span class="token operator">+</span> <span class="token function">bench</span><span class="token punctuation">(</span>diffGetTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'ms'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>看起来使用 <code>getTime()</code> 这种方式快得多，这是因为它没有进行类型转换，对引擎优化来说更加简单。</p> <p>我们得到了结论，但是这并不是一个很好的度量的例子。</p> <p>想象一下当运行 <code>bench(diffSubtract)</code> 的同时，CPU 还在并行处理其他事务，并且这也会占用资源。然而，运行 <code>bench(diffGetTime)</code> 的时候，并行处理的事务完成了。</p> <p>对于现代多进程操作系统来说，这是一个非常常见的场景。</p> <p>比起第二个函数，第一个函数所能使用的 CPU 资源更少。这可能导致错误的结论。</p> <p><strong>为了得到更加可靠的度量，整个度量测试包应该重新运行多次。</strong></p> <p>例如，像下面的代码这样：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">diffSubtract</span><span class="token punctuation">(</span><span class="token parameter">date1<span class="token punctuation">,</span> date2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> date2 <span class="token operator">-</span> date1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">diffGetTime</span><span class="token punctuation">(</span><span class="token parameter">date1<span class="token punctuation">,</span> date2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> date2<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> date1<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">bench</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> date1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> date2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">f</span><span class="token punctuation">(</span>date1<span class="token punctuation">,</span> date2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> time1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> time2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token comment">// 交替运行 bench(diffSubtract) 和 bench(diffGetTime) 各 10 次</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  time1 <span class="token operator">+=</span> <span class="token function">bench</span><span class="token punctuation">(</span>diffSubtract<span class="token punctuation">)</span><span class="token punctuation">;</span>
  time2 <span class="token operator">+=</span> <span class="token function">bench</span><span class="token punctuation">(</span>diffGetTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">*</span><span class="token operator">/</span><span class="token operator">!</span><span class="token operator">*</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'Total time for diffSubtract: '</span> <span class="token operator">+</span> time1 <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">'Total time for diffGetTime: '</span> <span class="token operator">+</span> time2 <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>现代的 JavaScript 引擎的先进优化策略只对执行很多次的 &quot;hot code&quot; 有效（对于执行很少次数的代码没有必要优化）。因此，在上面的例子中，第一次执行的优化程度不高。我们可能需要增加一个预热步骤：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 在主循环中增加预热环节</span>
<span class="token function">bench</span><span class="token punctuation">(</span>diffSubtract<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bench</span><span class="token punctuation">(</span>diffGetTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 开始度量</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  time1 <span class="token operator">+=</span> <span class="token function">bench</span><span class="token punctuation">(</span>diffSubtract<span class="token punctuation">)</span><span class="token punctuation">;</span>
  time2 <span class="token operator">+=</span> <span class="token function">bench</span><span class="token punctuation">(</span>diffGetTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">进行微型基准测试时要小心</p> <p>现代的 JavaScript 引擎执行了很多优化。与正常编写的代码相比，它们可能会改变“人为编写的专用于测试的代码”的执行流程，特别是在我们对很小的代码片段进行基准测试时，例如某个运算符或内建函数的工作方式。因此，为了深入理解性能问题，请学习 JavaScript 引擎的工作原理。在那之后，你或许再也不需要进行微型基准测试了。
<a href="http://mrale.ph" target="_blank" rel="noopener noreferrer">http://mrale.ph<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 提供了很多 V8 引擎相关的文章。</p></div> <h4 id="_5-11-8-对字符串调用-date-parse"><a href="#_5-11-8-对字符串调用-date-parse" class="header-anchor">#</a> 5.11.8 对字符串调用 Date.parse</h4> <p><a href="mdn:js/Date/parse">Date.parse(str)</a> 方法可以从一个字符串中读取日期。</p> <p>字符串的格式应该为：<code>YYYY-MM-DDTHH:mm:ss.sssZ</code>，其中：</p> <ul><li><code>YYYY-MM-DD</code> —— 日期：年-月-日。</li> <li>字符 <code>&quot;T&quot;</code> 是一个分隔符。</li> <li><code>HH:mm:ss.sss</code> —— 时间：小时，分钟，秒，毫秒。</li> <li>可选字符 <code>'Z'</code> 为 <code>+-hh:mm</code> 格式的时区。单个字符 <code>Z</code> 代表 UTC+0 时区。</li></ul> <p>简短形式也是可以的，比如 <code>YYYY-MM-DD</code> 或 <code>YYYY-MM</code>，甚至可以是 <code>YYYY</code>。</p> <p><code>Date.parse(str)</code> 调用会解析给定格式的字符串，并返回时间戳（自 1970-01-01 00:00:00 起所经过的毫秒数）。如果给定字符串的格式不正确，则返回 <code>NaN</code>。</p> <p>举个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> ms <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'2012-01-26T13:51:50.417-07:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1327611110417  (时间戳)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>我们可以通过时间戳来立即创建一个 <code>new Date</code> 对象：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span> Date<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'2012-01-26T13:51:50.417-07:00'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_5-12-json"><a href="#_5-12-json" class="header-anchor">#</a> 5.12 JSON</h3> <p><a href="https://en.wikipedia.org/wiki/JSON" target="_blank" rel="noopener noreferrer">JSON<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（JavaScript Object Notation）是表示值和对象的通用格式。在 <a href="https://tools.ietf.org/html/rfc4627" target="_blank" rel="noopener noreferrer">RFC 4627<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 标准中有对其的描述。最初它是为 JavaScript 而创建的，但许多其他编程语言也有用于处理它的库。因此，当客户端使用 JavaScript 而服务器端是使用 Ruby/PHP/Java 等语言编写的时，使用 JSON 可以很容易地进行数据交换。</p> <p>JavaScript 提供了如下方法：</p> <ul><li><code>JSON.stringify</code> 将对象转换为 JSON。</li> <li><code>JSON.parse</code> 将 JSON 转换回对象。</li></ul> <h4 id="_5-12-1-json-stringify"><a href="#_5-12-1-json-stringify" class="header-anchor">#</a> 5.12.1 JSON.stringify</h4> <p>例如，在这里我们 <code>JSON.stringify</code> 一个 <code>student</code> 对象：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> student <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isAdmin</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">courses</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token string">'css'</span><span class="token punctuation">,</span> <span class="token string">'js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">spouse</span><span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// we've got a string!</span>
<span class="token function">alert</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* JSON 编码的对象：
{
  &quot;name&quot;: &quot;John&quot;,
  &quot;age&quot;: 30,
  &quot;isAdmin&quot;: false,
  &quot;courses&quot;: [&quot;html&quot;, &quot;css&quot;, &quot;js&quot;],
  &quot;spouse&quot;: null
}
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>方法 <code>JSON.stringify(student)</code> 接收对象并将其转换为字符串。</p> <p>得到的 <code>json</code> 字符串是一个被称为 <strong>JSON 编码（JSON-encoded）</strong> 或 <strong>序列化（serialized）</strong> 或 <strong>字符串化（stringified）</strong> 或 <strong>编组化（marshalled）</strong> 的对象。我们现在已经准备好通过有线发送它或将其放入普通数据存储。</p> <p>请注意，JSON 编码的对象与对象字面量有几个重要的区别：</p> <ul><li>字符串使用双引号。JSON 中没有单引号或反引号。所以 <code>'John'</code> 被转换为 <code>&quot;John&quot;</code>。</li> <li>对象属性名称也是双引号的。这是强制性的。所以 <code>age:30</code> 被转换成 <code>&quot;age&quot;:30</code>。</li></ul> <p><code>JSON.stringify</code> 也可以应用于原始（primitive）数据类型。</p> <p>JSON 支持以下数据类型：</p> <ul><li>Objects <code>{ ... }</code></li> <li>Arrays <code>[ ... ]</code></li> <li>Primitives：
<ul><li>strings，</li> <li>numbers，</li> <li>boolean values <code>true/false</code>，</li> <li><code>null</code>。</li></ul></li></ul> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 数字在 JSON 还是数字</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token comment">// 字符串在 JSON 中还是字符串，只是被双引号扩起来</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token comment">// &quot;test&quot;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1,2,3]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>JSON 是语言无关的纯数据规范，因此一些特定于 JavaScript 的对象属性会被 <code>JSON.stringify</code> 跳过。</p> <p>即：</p> <ul><li>函数属性（方法）。</li> <li>Symbol 类型的键和值。</li> <li>存储 <code>undefined</code> 的属性。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 被忽略</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token comment">// 被忽略</span>
  <span class="token literal-property property">something</span><span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token comment">// 被忽略</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {}（空对象）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>通常这很好。如果这不是我们想要的方式，那么我们很快就会看到如何自定义转换方式。</p> <p>最棒的是支持嵌套对象转换，并且可以自动对其进行转换。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> meetup <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Conference&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">room</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>
    <span class="token literal-property property">participants</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;john&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ann&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>meetup<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 整个结构都被字符串化了
{
  &quot;title&quot;:&quot;Conference&quot;,
  &quot;room&quot;:{&quot;number&quot;:23,&quot;participants&quot;:[&quot;john&quot;,&quot;ann&quot;]},
}
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>重要的限制：不得有循环引用。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> room <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">23</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> meetup <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Conference&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">participants</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;john&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ann&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
meetup<span class="token punctuation">.</span>place <span class="token operator">=</span> room<span class="token punctuation">;</span>       <span class="token comment">// meetup 引用了 room</span>
room<span class="token punctuation">.</span>occupiedBy <span class="token operator">=</span> meetup<span class="token punctuation">;</span> <span class="token comment">// room 引用了 meetup</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>meetup<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: Converting circular structure to JSON</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在这里，转换失败了，因为循环引用：<code>room.occupiedBy</code> 引用了 <code>meetup</code>，<code>meetup.place</code> 引用了 <code>room</code>：</p> <h4 id="_5-12-2-排除和转换-replacer"><a href="#_5-12-2-排除和转换-replacer" class="header-anchor">#</a> 5.12.2 排除和转换：replacer</h4> <p><code>JSON.stringify</code> 的完整语法是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>value<span class="token punctuation">[</span><span class="token punctuation">,</span> replacer<span class="token punctuation">,</span> space<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>value
: 要编码的值。</p> <p>replacer
: 要编码的属性数组或映射函数 <code>function(key, value)</code>。</p> <p>space
: 用于格式化的空格数量</p> <p>大部分情况，<code>JSON.stringify</code> 仅与第一个参数一起使用。但是，如果我们需要微调替换过程，比如过滤掉循环引用，我们可以使用 <code>JSON.stringify</code> 的第二个参数。</p> <p>如果我们传递一个属性数组给它，那么只有这些属性会被编码。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> room <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">23</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> meetup <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Conference&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">participants</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Alice&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">place</span><span class="token operator">:</span> room <span class="token comment">// meetup 引用了 room</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
room<span class="token punctuation">.</span>occupiedBy <span class="token operator">=</span> meetup<span class="token punctuation">;</span> <span class="token comment">// room 引用了 meetup</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>meetup<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'participants'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// {&quot;title&quot;:&quot;Conference&quot;,&quot;participants&quot;:[{},{}]}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这里我们可能过于严格了。属性列表应用于了整个对象结构。所以 <code>participants</code> 是空的，因为 <code>name</code> 不在列表中。</p> <p>让我们包含除了会导致循环引用的 <code>room.occupiedBy</code> 之外的所有属性：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> room <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">23</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> meetup <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Conference&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">participants</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Alice&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">place</span><span class="token operator">:</span> room <span class="token comment">// meetup 引用了 room</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
room<span class="token punctuation">.</span>occupiedBy <span class="token operator">=</span> meetup<span class="token punctuation">;</span> <span class="token comment">// room 引用了 meetup</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>meetup<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'participants'</span><span class="token punctuation">,</span> <span class="token string">'place'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
{
  &quot;title&quot;:&quot;Conference&quot;,
  &quot;participants&quot;:[{&quot;name&quot;:&quot;John&quot;},{&quot;name&quot;:&quot;Alice&quot;}],
  &quot;place&quot;:{&quot;number&quot;:23}
}
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>现在，除 <code>occupiedBy</code> 以外的所有内容都被序列化了。但是属性的列表太长了。</p> <p>幸运的是，我们可以使用一个函数代替数组作为 <code>replacer</code>。</p> <p>该函数会为每个 <code>(key,value)</code> 对调用并返回“已替换”的值，该值将替换原有的值。如果值被跳过了，则为 <code>undefined</code>。</p> <p>在我们的例子中，我们可以为 <code>occupiedBy</code> 以外的所有内容按原样返回 <code>value</code>。为了 <code>occupiedBy</code>，下面的代码返回 <code>undefined</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> room <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">23</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> meetup <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Conference&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">participants</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Alice&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">place</span><span class="token operator">:</span> room <span class="token comment">// meetup 引用了 room</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
room<span class="token punctuation">.</span>occupiedBy <span class="token operator">=</span> meetup<span class="token punctuation">;</span> <span class="token comment">// room 引用了 meetup</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>meetup<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">replacer</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token string">'occupiedBy'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* key:value pairs that come to replacer:
:             [object Object]
title:        Conference
participants: [object Object],[object Object]
0:            [object Object]
name:         John
1:            [object Object]
name:         Alice
place:        [object Object]
number:       23
occupiedBy: [object Object]
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>请注意 <code>replacer</code> 函数会获取每个键/值对，包括嵌套对象和数组项。它被递归地应用。<code>replacer</code> 中的 <code>this</code> 的值是包含当前属性的对象。</p> <p>第一个调用很特别。它是使用特殊的“包装对象”制作的：<code>{&quot;&quot;: meetup}</code>。换句话说，第一个 <code>(key, value)</code> 对的键是空的，并且该值是整个目标对象。这就是上面的示例中第一行是 <code>&quot;:[object Object]&quot;</code> 的原因。</p> <p>这个理念是为了给 <code>replacer</code> 提供尽可能多的功能：如果有必要，它有机会分析并替换/跳过整个对象。</p> <h4 id="_5-12-3-格式化-space"><a href="#_5-12-3-格式化-space" class="header-anchor">#</a> 5.12.3 格式化：space</h4> <p><code>JSON.stringify(value, replacer, spaces)</code> 的第三个参数是用于优化格式的空格数量。</p> <p>以前，所有字符串化的对象都没有缩进和额外的空格。如果我们想通过网络发送一个对象，那就没什么问题。<code>space</code> 参数专门用于调整出更美观的输出。</p> <p>这里的 <code>space = 2</code> 告诉 JavaScript 在多行中显示嵌套的对象，对象内部缩进 2 个空格：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
  <span class="token literal-property property">roles</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">isAdmin</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isEditor</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 两个空格的缩进：
{
  &quot;name&quot;: &quot;John&quot;,
  &quot;age&quot;: 25,
  &quot;roles&quot;: {
    &quot;isAdmin&quot;: false,
    &quot;isEditor&quot;: true
  }
}
*/</span>
<span class="token comment">/* 对于 JSON.stringify(user, null, 4) 的结果会有更多缩进：
{
    &quot;name&quot;: &quot;John&quot;,
    &quot;age&quot;: 25,
    &quot;roles&quot;: {
        &quot;isAdmin&quot;: false,
        &quot;isEditor&quot;: true
    }
}
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>第三个参数也可以是字符串。在这种情况下，字符串用于缩进，而不是空格的数量。</p> <p><code>spaces</code> 参数仅用于日志记录和美化输出。</p> <h4 id="_5-12-4-自定义-tojson"><a href="#_5-12-4-自定义-tojson" class="header-anchor">#</a> 5.12.4 自定义 &quot;toJSON&quot;</h4> <p>像 <code>toString</code> 进行字符串转换，对象也可以提供 <code>toJSON</code> 方法来进行 JSON 转换。如果可用，<code>JSON.stringify</code> 会自动调用它。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> room <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">23</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> meetup <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Conference&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token constant">UTC</span><span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  room
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>meetup<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
  {
    &quot;title&quot;:&quot;Conference&quot;,
    &quot;date&quot;:&quot;2017-01-01T00:00:00.000Z&quot;,  // (1)
    &quot;room&quot;: {&quot;number&quot;:23}               // (2)
  }
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>在这儿我们可以看到 <code>date</code> <code>(1)</code> 变成了一个字符串。这是因为所有日期都有一个内建的 <code>toJSON</code> 方法来返回这种类型的字符串。</p> <p>现在让我们为对象 <code>room</code> 添加一个自定义的 <code>toJSON</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> room <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>
  <span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>number<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> meetup <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Conference&quot;</span><span class="token punctuation">,</span>
  room
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 23</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>meetup<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
  {
    &quot;title&quot;:&quot;Conference&quot;,
    &quot;room&quot;: 23
  }
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>正如我们所看到的，<code>toJSON</code> 既可以用于直接调用 <code>JSON.stringify(room)</code> 也可以用于当 <code>room</code> 嵌套在另一个编码对象中时。</p> <h4 id="_5-12-5-json-parse"><a href="#_5-12-5-json-parse" class="header-anchor">#</a> 5.12.5  JSON.parse</h4> <p>要解码 JSON 字符串，我们需要另一个方法 <a href="mdn:js/JSON/parse">JSON.parse</a>。</p> <p>语法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token punctuation">[</span>reviver<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>str
: 要解析的 JSON 字符串。</p> <p>reviver
: 可选的函数 function(key,value)，该函数将为每个 <code>(key, value)</code> 对调用，并可以对值进行转换。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 字符串化数组</span>
<span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token string">&quot;[0, 1, 2, 3]&quot;</span><span class="token punctuation">;</span>
numbers <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> numbers<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>对于嵌套对象：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> userData <span class="token operator">=</span> <span class="token string">'{ &quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 35, &quot;isAdmin&quot;: false, &quot;friends&quot;: [0,1,2,3] }'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>userData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> user<span class="token punctuation">.</span>friends<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>JSON 可能会非常复杂，对象和数组可以包含其他对象和数组。但是它们必须遵循相同的 JSON 格式。</p> <p>以下是手写 JSON 时的典型错误（有时我们必须出于调试目的编写它）：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{
  name: &quot;John&quot;,                     // 错误：属性名没有双引号
  &quot;surname&quot;: 'Smith',               // 错误：值使用的是单引号（必须使用双引号）
  'isAdmin': false                  // 错误：键使用的是单引号（必须使用双引号）
  &quot;birthday&quot;: new Date(2000, 2, 3), // 错误：不允许使用 &quot;new&quot;，只能是裸值
  &quot;friends&quot;: [0,1,2,3]              // 这个没问题
}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>此外，JSON 不支持注释。向 JSON 添加注释无效。</p> <p>还有另一种名为 <a href="http://json5.org/" target="_blank" rel="noopener noreferrer">JSON5<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的格式，它允许未加引号的键，也允许注释等。但这是一个独立的库，不在语言的规范中。</p> <p>常规的 JSON 格式严格，并不是因为它的开发者很懒，而是为了实现简单，可靠且快速地实现解析算法。</p> <h4 id="_5-12-6-使用-reviver"><a href="#_5-12-6-使用-reviver" class="header-anchor">#</a> 5.12.6 使用 reviver</h4> <p>想象一下，我们从服务器上获得了一个字符串化的 <code>meetup</code> 对象。</p> <p>它看起来像这样：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// title: (meetup title), date: (meetup date)</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'{&quot;title&quot;:&quot;Conference&quot;,&quot;date&quot;:&quot;2017-11-30T12:00:00.000Z&quot;}'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>……现在我们需要对它进行 <strong>反序列（deserialize）</strong>，把它转换回 JavaScript 对象。</p> <p>让我们通过调用 <code>JSON.parse</code> 来完成：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'{&quot;title&quot;:&quot;Conference&quot;,&quot;date&quot;:&quot;2017-11-30T12:00:00.000Z&quot;}'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> meetup <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> meetup<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>啊！报错了！</p> <p><code>meetup.date</code> 的值是一个字符串，而不是 <code>Date</code> 对象。<code>JSON.parse</code> 怎么知道应该将字符串转换为 <code>Date</code> 呢？</p> <p>让我们将 reviver 函数传递给 <code>JSON.parse</code> 作为第二个参数，该函数按照“原样”返回所有值，但是 <code>date</code> 会变成 <code>Date</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'{&quot;title&quot;:&quot;Conference&quot;,&quot;date&quot;:&quot;2017-11-30T12:00:00.000Z&quot;}'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> meetup <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token string">'date'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> meetup<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 现在正常运行了！</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>顺便说一下，这也适用于嵌套对象：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> schedule <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{
  &quot;meetups&quot;: [
    {&quot;title&quot;:&quot;Conference&quot;,&quot;date&quot;:&quot;2017-11-30T12:00:00.000Z&quot;},
    {&quot;title&quot;:&quot;Birthday&quot;,&quot;date&quot;:&quot;2017-04-18T12:00:00.000Z&quot;}
  ]
}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
schedule <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>schedule<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token string">'date'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span> schedule<span class="token punctuation">.</span>meetups<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 正常运行了！</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/ad315d/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Object对象</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/ad315d/" class="prev">Object对象</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/37eb01/"><div>
            变换
            <!----></div></a> <span class="date">08-10</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/26dab9/"><div>
            向量与线性代数
            <!----></div></a> <span class="date">08-09</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/3bf799/"><div>
            ThreeJS
            <!----></div></a> <span class="date">08-08</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1565330830@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/wsy425" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.43c2cf26.js" defer></script><script src="/assets/js/2.f96eca0e.js" defer></script><script src="/assets/js/45.72e29209.js" defer></script>
  </body>
</html>
